## Optimal execution on Uniswap v2/v3 under transient price impact

Bastien Baude [∗] Damien Challet [†] Ioane Muni Toke [‡]


_Universit´e Paris-Saclay, CentraleSup´elec, Laboratoire MICS_
_91192 Gif-sur-Yvette, France_


January 8, 2026


**Abstract**


We study the optimal liquidation of a large position on Uniswap v2 and Uniswap v3 in discrete time.
The instantaneous price impact is derived from the AMM pricing rule. Transient impact is modeled to
capture either exponential or approximately power-law decay, together with a permanent component. In
the Uniswap v2 setting, we obtain optimal strategies in closed-form under general price dynamics. For
Uniswap v3, we consider a two-layer liquidity framework, which naturally extends to multiple layers.
We address the problem using dynamic programming under geometric Brownian motion dynamics and
approximate the solution numerically using a discretization scheme. We obtain optimal strategies akin
to classical ones in the LOB literature, with features specific to Uniswap. In particular, we show how
the liquidity profile influences them.


**Keywords**   - Decentralized finance, decentralized exchange, automated market makers, Uniswap, market
microstructure, optimal execution, optimal scheduling problem.

### **Contents**


**1** **Introduction** **2**


**2** **The optimal scheduling problem on Uniswap v2** **3**
2.1 Mathematical framework . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
2.2 Optimal execution strategy . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
2.2.1 Problem formulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
2.2.2 General solution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5
2.2.3 Dynamic programming . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
2.3 Numerical results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
2.3.1 Illustrations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
2.3.2 Sensitivity analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
2.3.3 Open-loop versus closed-loop . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
2.4 Incorporating fees . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17


**3** **From Uniswap v2 to v3** **17**
3.1 A two-layer liquidity framework . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
3.2 Discretization scheme . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
3.3 Numerical results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19


**4** **Discussion and conclusion** **21**


[∗bastien.baude@centralesupelec.fr](mailto:bastien.baude@centralesupelec.fr) [†damien.challet@centralesupelec.fr](mailto:damien.challet@centralesupelec.fr) [‡ioane.muni-toke@centralesupelec.fr](mailto:ioane.muni-toke@centralesupelec.fr)


1


### **1 Introduction**

Crypto-assets are primarily traded on two types of venues: Centralized Exchanges (CEXs) and Decentralized
Exchanges (DEXs). Whereas CEXs rely on Limit Order Books (LOBs) to match buyers and sellers, DEXs
execute transactions on blockchain networks using liquidity pools. Liquidity Providers (LPs) deposit cryptoassets into these pools, while Liquidity Takers (LTs) trade against them. Transaction terms are set by
algorithmic pricing rules known as Automated Market Makers (AMMs). Fees are charged on trades and
shared between LPs and DEXs.


Uniswap has played a central role in defining the architecture of DEXs. Uniswap v1, launched in 2018, allows
users to trade crypto-assets against Ethereum (ETH) and introduced the Constant Product AMM (CPAMM).
This mechanism was formalized and generalized in Uniswap v2 (Adams et al., 2020) which supports arbitrary
crypto-asset pairs. Uniswap v3 (Adams et al., 2021), extends the CPAMM by introducing the concept of
Concentrated Liquidity AMM (CLAMM). LPs are no longer required to allocate capital across the entire
price range; instead, they can specify custom price intervals in which their liquidity is active. Alternative
AMMs have emerged to address specific types of crypto-asset pairs, for example Curve (Egorov, 2019) and
Balancer (Martinelli and Mushegian, 2019).


The Total Value Locked (TVL) refers to the value of the crypto-assets, generally expressed in dollars, held
in liquidity pools. As of September 2025, TVL across all DEXs was $25b, [1] with an average daily trading
volume of $12 _._ 5b. Uniswap had $6b in TVL and processed an average daily volume of $4 _._ 5b.


The challenge faced by LTs when executing large trades on LOBs has been extensively studied in the
literature. The Almgren-Chriss framework (Almgren and Chriss, 1999, 2001) pioneers optimal execution
modelling by formulating the trade-off between execution costs and the risk of adverse price movements
during execution. The model, written in discrete time, combines linear instantaneous and permanent price
impacts with a Bachelier dynamic for the fundamental price. The continuous-time counterpart with nonlinear
instantaneous impact is developed in Almgren (2003). Several extensions are proposed in Gu´eant (2016) and
Cartea et al. (2015). While the Almgren-Chriss model includes instantaneous and permanent price impacts,
it assumes no gradual recovery of the price following a trade. This intermediate regime, known as transient
market impact, is accounted for in Obizhaeva and Wang (2013); their model has been extended in various
directions; see Alfonsi et al. (2010, 2008) and Gatheral et al. (2012); Curato et al. (2017). Notably, Alfonsi
et al. (2010) generalize the model to arbitrary LOB shape functions. While CPAMMs can be seen as LOBs
with virtual shape functions (Tran et al., 2024), the results of Alfonsi et al. (2010) do not apply as these
shapes depend on the stochastic spot price and the assumption of infinite LOB depth does not hold.


Few works have addressed the optimal execution problem on AMMs. Cartea et al. (2025) develop a
continuous-time model in the spirit of Almgren-Chriss, applied to CPAMMs. A first-order approximation
is used for the instantaneous price impact, while the permanent impact is assumed to be linear. Different
price dynamics are considered, involving both CEX and DEX. However, to the best of our knowledge, the
literature has not yet addressed the optimal execution problem on AMMs under transient price impact.


In this paper, we study the optimal execution problem under transient price impact, first on CPAMMs and
then CLAMMs. The spot price is modeled as the combination of three components: (i) a fundamental price
process; (ii) the cumulative price impact induced by past trades; and (iii) a transient impact model. The
instantaneous price impact is derived from the AMM pricing rule. Following Cartea et al. (2025), we consider
a first-order expansion, under which the price impact depends on the square root of the spot price and is
therefore stochastic. In the spirit of Obizhaeva and Wang (2013), transient price impact is described by a
combination of exponential kernels in order to capture either exponential or approximately power-law decay,
together with a permanent component. The execution problem is formulated in discrete time and consists
in maximizing the expected total cash-flow resulting from liquidation. For CPAMMs, we obtain closedform solutions under general fundamental price dynamics. For CLAMMs, we consider a two-layer liquidity
framework and formulate the problem in a dynamic programming framework under geometric Brownian


1 Data sourced from DefiLlama, available at `[https://defillama.com/protocols/dexs](https://defillama.com/protocols/dexs)` .


2


motion. We then propose a numerical scheme to approximate the solution. Under zero-drift fundamental
price dynamics and a first-order approximation, the solution on CPAMMs is independent of the liquidity,
whereas on CLAMMs, it adapts to both liquidity levels and the position of the spot price relative to the
price threshold where liquidity changes.


The remainder of the paper is organized as follows. Section 2 introduces the optimal execution problem
on CPAMMs under transient price impact and provides closed-form solutions under general fundamental
price dynamics. Anticipating that no closed-form solution is available in the CLAMMs case, the problem is
also reformulated and solved within a dynamic programming framework under geometric Brownian motion
assumption. Several scenarios are then considered to illustrate the results. Section 3 turns to the CLAMMs
case and presents a numerical scheme to approximate the solution. Results are illustrated within a two-layer
liquidity framework, which naturally extends to multiple layers.

### **2 The optimal scheduling problem on Uniswap v2**


**2.1** **Mathematical framework**


We consider a liquidity pool governed by a Constant Product Automated Market Maker (CPAMM), following
the Uniswap v2 design. The pool consists of two tokens (i.e., crypto-assets), denoted by token _a_ (e.g., ETH)
and token _b_ (e.g., USDT), with reserves _q_ _[a]_ and _q_ _[b]_ respectively. The constant product formula defining the
AMM is:
_q_ _[a]_ _q_ _[b]_ = _L_ [2] _,_ (1)


where _L_ is the liquidity of the pool. The spot price of token _a_ in terms of token _b_ (e.g., the price of ETH in
USDT) is given by:

_p_ = _[q][b]_ (2)

_q_ _[a]_ _[.]_


Liquidity takers execute trades against the pool. Suppose a trader wants to sell _δ_ _[a]_ _>_ 0 units of token _a_ : the
AMM determines the amount _δ_ _[b]_ _>_ 0 of token _b_ to be received by solving:


( _q_ _[a]_ + _δ_ _[a]_ )( _q_ _[b]_ _−_ _δ_ _[b]_ ) = _L_ [2] _,_ (3)


assuming no fees. Fees are discussed in Section 2.4. The trade is settled in such a way that the constant
product formula (1) remains satisfied after the swap. Solving (3) for _δ_ _[b]_ yields:


_L_ [2]
_δ_ _[b]_ = _q_ _[b]_ _−_ _q_ _[a]_ + _δ_ _[a]_ _[.]_ (4)


From (1) and (2), the reserves can be expressed in terms of liquidity and spot price:


_q_ _[a]_ = ~~_√_~~ _[L]_ _,_ _q_ _[b]_ = _L_ _[√]_ ~~_p._~~ (5)
~~_p_~~


Substituting into (4), the amount _δ_ _[b]_ received by the trader becomes:




    
~~_[√][p]_~~ _≈_ _δ_ _[a]_ _p_ 1 _−_ _[δ][a]_ _L_ _[√]_ ~~_[p]_~~

_L_



_δ_ _[a]_ _p_
_δ_ _[b]_ =



_L_



1 + _[δ][a]_ ~~_[√][p]_~~




_,_ (6)



where the approximation corresponds to a first-order Taylor expansion in the dimensionless term _[δ][a]_ ~~_[√][p]_~~



_L_ ~~_[p]_~~ = _q_ _[δ][a][a]_



where the approximation corresponds to a first-order Taylor expansion in the dimensionless term _L_ = _q_ _[a]_ [.]

This assumes that the trade size is small relative to the reserve of token _a_ .



3


We now define the execution price of the trade, denoted by ~~_p_~~ ~~,~~ as the average exchange rate obtained over
the entire trade:



~~_p_~~ = _[δ][b]_



1 + _[δ][a]_ ~~_[√][p]_~~




_[δ]_ _p_

_δ_ _[a]_ [=] _[δ]_




   
~~_[√][p]_~~ _≈_ _p_ 1 _−_ _[δ][a]_ _L_ _[√]_ ~~_[p]_~~

_L_



_L_




_,_ (7)



where the approximation corresponds to a first-order expansion in _[δ][a]_ _L_ ~~_[√][p]_~~ [. This represents the effective price]

paid by the trader per unit of token _a_ over the full trade. In contrast to the spot price _p_, which reflects
the marginal price before the trade, the execution price accounts for the cumulative effect of moving along
the AMM curve. As emphasized in Cartea et al. (2025), Equation (7) is explicitly derived from the AMM
pricing rule, in contrast to LOBs, where execution costs are model-dependent. Next, the slippage is defined
as the relative deviation of the execution price from the spot price. From the first-order expansion in (7), it
is approximated by _−_ _[δ][a]_ _L_ ~~_[√][p]_~~ [. The slope of the slippage with respect to trade size depends on the spot price]

and therefore becomes stochastic under stochastic spot price dynamics.


The post-swap spot price is given by:



_p_ [+] = _[q][b][ −]_ _[δ][b]_




    
~~_[√][p]_~~ ~~�~~ 2 _[≈]_ _[p]_ 1 _−_ [2] _[δ][a]_ _L_ _[√]_ ~~_[p]_~~

_L_



_L_




_[q]_ _[δ]_ _p_

_q_ _[a]_ + _δ_ _[a]_ [=] ~~�~~ 1 + _[δ][a]_ ~~_[√][p]_~~




_,_ (8)



where the approximation also corresponds to a first-order expansion in _[δ][a]_ ~~_[√][p]_~~



where the approximation also corresponds to a first-order expansion in _L_ [. This expression reflects the]

marginal price immediately after the trade and thus incorporates the impact induced by the trade size. The
relative price impact is defined as the relative difference between the post-swap spot price and the pre-swap
spot price. From the first-order expansion in (8), it is approximated by _−_ [2] _[δ][a]_ ~~_[√][p]_~~, twice the slippage.



_L_, twice the slippage.



**2.2** **Optimal execution strategy**


**2.2.1** **Problem formulation**


We consider the problem of a trader willing to execute a large sell order of size _ξ >_ 0 of token _a_ over a fixed
time horizon _T_ . The time interval [0 _, T_ ] is divided into a regular partition: 0 = _t_ 0 _< t_ 1 _< · · · < tN_ = _T_,
with constant time step ∆= _N_ _[T]_ [. At each time] _[ t][n]_ [, the trader sells an amount] _[ δ][n]_ [ (for the sake of readability,]

the superscript _a_ is omitted), subject to the volume constraint:


_N_

        - _δn_ = _ξ._ (9)


_n_ =0


Although the problem is formulated for a large sell order, the large buy order case is analogous.


We assume that the spot price is a combination of three components: (i) a fundamental price process, treated
as an exogenous stochastic process capturing market volatility and external factors; (ii) the cumulative price
impact induced by previous trades; and (iii) the resilience of the liquidity pool, reflecting the gradual recovery
of the spot price following each trade. First, we denote by ( _fm_ ) _[N]_ _m_ =0 [the fundamental price process, with] _[ f]_ [0]
given as a deterministic initial price. The fundamental price may be interpreted as a reference price, such
as the CEX price under the assumption of no friction between CEX and DEX markets. More generally, it
corresponds to the spot price from the DEX that would have prevailed in the absence of price impact from
the trader’s execution schedule, and thus our model also covers crypto-assets not listed on CEXs. Second,
the impact on the spot price at time _tm_ induced by the previous trades ( _δn_ ) _[m]_ _n_ =0 _[−]_ [1] [is derived from the price]
impact formula (8). Third, the resilience of the liquidity pool is given by a convex combination of exponential
price recovery terms. Hence, we write the spot price at time _tm_, for _m_ = 0 _, . . ., N_, as:



_J_ _√_

- _ωje_ _[−][ρ][j]_ [(] _[m][−][n]_ [)∆] [2] _[δ][n]_ _fn_

_L_
_j_ =0


4




    _pm_ = _fm_ 1 _−_



_m−_ 1



_n_ =0




_,_ (10)


where ( _ρj_ ) _[J]_ _j_ =0 [are resilience parameters and (] _[ω][j]_ [)] _j_ _[J]_ =0 [the associated weights, satisfying] _[ ρ][j][ ≥]_ [0,] _[ ω][j][ ≥]_ [0 for]
_j_ = 0 _, . . ., J_ and [�] _j_ _[J]_ =0 _[ω][j]_ [ = 1. A permanent impact component can be accounted for by taking a resilience]
parameter to zero. Equation (10) is constructed by successively applying the relative price impact formula (8)
~~_√_~~
induced by previous trades, combined with a first-order expansion in the dimensionless terms ( _[δ][n]_ _Lfn_ ) _[m]_ _n_ =0 _[−]_ [1][.]

Then, we multiply the relative price impacts by the resilience factors ( [�] _[J]_ _j_ =0 _[ω][j][e][−]_ [(] _[m][−][n]_ [)∆] _[ρ][j]_ [)] _n_ _[m]_ =0 _[−]_ [1][. Moreover,]
the liquidity of the pool is assumed to remain constant throughout the trading horizon, i.e., LPs are passive.
This modeling choice is supported by the empirical findings of Cartea et al. (2025), who report limited LP
activity relative to LTs and stable pool liquidity over the relevant execution horizons.


The cash-flow at time _tm_ from selling _δm_ units is derived by substituting the spot pric ~~_√_~~ e from (10) into the
cash-flow formula (6) and is also a first-order expansion in the dimensionless terms ( _[δ][n]_ _Lfn_ ) _[m]_ _n_ =0 _[−]_ [1][:]



_J_ _√_ _√_

- _ωje_ _[−][ρ][j]_ [(] _[m][−][n]_ [)∆] [2] _[δ][n]_ _fn_ _−_ _[δ][m]_ _fm_

_L_ _L_
_j_ =0




    _Cm_ = _δmfm_ 1 _−_



_m−_ 1



_n_ =0



_J_




_L_




_._ (11)



The execution price that determines the cash-flow at time _tm_ combines two effects both resulting from the
trader’s actions: the cumulative impact of past trades on the spot price and the slippage induced by the
current trade.


We now formulate the execution problem of the trader. The objective is to determine the optimal sequence
of trade sizes _δ_ = - _δ_ 0 _, . . ., δN_ - _⊤_ that maximizes the expected total cash-flow, corresponding to the sum over
time of the contributions defined in (11), subject to the volume constraint (9):



_N_

        -        -        _δ_ _[∗]_ = argmax E _Cn_
_δ_

_n_ =0



(12)



s.t.



_N_

- _δn_ = _ξ._


_n_ =0



The constraint ensures that the full order of size _ξ_ is executed over the time interval [0 _, T_ ]. The trades are
not _a priori_ required to be non-negative, as depending on the dynamics of the fundamental price, it may be
optimal to buy (or oversell relative to _ξ_ ) and later unwind the excess.


**2.2.2** **General solution**


We now state the general closed-form solution to the execution problem (12), formulated using the first-order
cash-flow expression (11).


**Proposition 1** (General solution) **.** _The optimal execution schedule is:_




_[L]_ - _A−_ 1 1

2 [1] _[⊤][A][−]_ [1] _[B]_ 1 _[⊤]_ _A_ _[−]_ [1]




_−_ 1

_L_ - _A_ _B_

2 [1] _[⊤][A][−]_ [1] _[B]_ 1 _[⊤]_ _A_ _[−]_ [1]




  _δ_ _[∗]_ = _ξ −_ _[L]_



_A_ 1 - _L_

1 _[⊤]_ _A_ _[−]_ [1] 1 [+] 2



(13)
1 _[⊤]_ _A_ _[−]_ [1] _B_ _[,]_



_where_ 1 = �1 _, . . .,_ 1� _⊤, the components of the vector B ∈_ R _N_ +1 _are defined as:_


_Bm_ = E[ _fm_ ] _,_ (14)


_and the entries of the matrix A ∈_ R [(] _[N]_ [+1)] _[×]_ [(] _[N]_ [+1)] _are given by:_



_Amn_ =



�� _J_ _√_

 - _jJj_ =0=0 _[ω][ω][j][j][e][e][−][−][ρ][ρ][j][j]_ [(][(] _[m][n][−][−][m][n]_ [)∆][)∆][E][E][[][[] _[f][f][m][n]_ _√ffmn_ ]] _ifif n > m. n ≤_ _m_ (15)


5


Equation (13) shows that the optimal execution schedule _δ_ _[∗]_ can be expressed as a linear combination of two
distinct profiles: one driven by resilience and expected price impacts ( _A_ _[−]_ [1] 1 ), and another that also accounts
for the expected price trajectory ( _A_ _[−]_ [1] _B_ ). This linear combination reflects the trade-off between minimizing
market impact and exploiting expected price dynamics. The respective weights depend on the total order
size _ξ_ and the liquidity level _L_ .


**Corollary 1** (Martingale case) **.** _If the fundamental price process is a martingale, the optimal solution_ (13)
_reduces to:_

_A_ _[−]_ [1] 1
_δ_ _[∗]_ = _ξ_ (16)
1 _[⊤]_ _A_ _[−]_ [1] 1 _[,]_


_where the matrix A is defined in_ (15) _._


In the martingale case, the solution is independent of the liquidity level _L_ : although liquidity affects the
overall cost of execution, it does not influence the shape of the optimal schedule in the martingale case. The
execution strategy is fully determined by the structure of resilience and expected price impacts. Recall that
this result is valid only at first order, i.e., when trades are small compared to the pool size.


**Corollary 2** (Geometric Brownian motion case) **.** _We assume that the fundamental price follows a geometric_
_Brownian motion evaluated at discrete times tm, for m_ = 0 _, . . ., N_ _:_


_fm_ = _f_ 0 _e_ [(] _[µ][−]_ _[σ]_ 2 [2] [)] _[m]_ [∆+] _[σW][m]_ _,_ (17)


_where f_ 0 _is the initial fundamental price, µ the drift, σ the volatility and Wm denotes the Brownian motion_
_at time tm. Under the condition µ <_ [3] _[σ]_ 4 [2] + 4 min _j ρj, the optimal strategy δ_ _[∗]_ _is unique. Moreover, in the_

_single exponential kernel setting (J_ = 0 _), the inverse of matrix A admits a closed-form expression:_



1 + _[a]_ [2]








_[a]_ _γ_ 1 _−_ _γ_ _[a]_



_γ_ 1 _−_ _γ_ 1 0 _· · ·_ 0

_−_ _[a]_ 1 [+] _[a]_ [2] _−_ _[a]_ _· · ·_ 0



_γ_ _[a]_ 1 _γ_ 11 [+] _[a]_ _γ_ 2 [2]



0 _−_ _γ_ 2 _γ_ 2 [+] _γ_ 3 _· · ·_ 0

_..._ _..._ _..._ _..._ _−_ _γ_ _[a]_ _N_

0 0 0 _−_ _[a]_ 1




_[a]_ _γ_ 2 _−_ _γ_ _[a]_



_γ_ _[a]_ _N_ _γ_ 1 _N_



_,_ (18)



1
_A_ _[−]_ [1] = ~~_√_~~
_f_ 0 _f_ 0







_γ_ 1 _γ_ 1 [+] _γ_ 2 _−_ _γ_ 2 _· · ·_ 0

0 _−_ _[a]_ 1 [+] _[a]_ [2] _· · ·_ 0



_γ_ _[a]_ 2 _γ_ 12 [+] _[a]_ _γ_ 3 [2]










             - 3 _µ_
_where a_ = _e_ _[−]_ [(] _[ρ][−][µ]_ [)∆] _, bn_ = _e_ 2




_[σ]_ [2] 
8 _n_ ∆ _and γn_ = _bn −_ _a_ 2 _bn−_ 1 _for n_ = 1 _, . . ., N_ _._



2 _µ_ [+] [3] _[σ]_ 8 [2]



The proofs are provided in Appendix A. While the inverse of _A_ can be expressed explicitly in the single
exponential kernel case, it must be computed numerically in the general multi-kernel setting.


**2.2.3** **Dynamic programming**


Anticipating that no general solution will be available in the CLAMMs case, we reformulate the execution
problem (12) within a dynamic programming framework. We distinguish between two settings: the closedloop case, which includes price feedback, and the open-loop case, which does not (Kirk, 2004). We start with
the closed-loop formulation, in which the state variables at time _tn_ are given by the triplet ( _xn,_ ( _In_ _[j]_ [)] _[J]_ _j_ =0 _[, f][n]_ [),]
where _xn_ is the remaining inventory, _In_ _[j]_ [the cumulative price impacts induced by the] _[ j]_ [-th resilience factor]
and _fn_ the fundamental price. The remaining inventory evolves according to:

             - _x_ 0 = _ξ_
(19)
_xn_ +1 = _xn −_ _δn._


The dynamics of the cumulative price impacts are derived from (10) and read:

          - _I_ 0 _[j]_ [= 0] ~~_√_~~

_In_ _[j]_ +1 [=] _[ e][−][ρ][j]_ [∆][�] _In_ _[j]_ [+] [2] _[δ][n]_ _L_ _fn_                    - _,_ (20)


6


for _j_ = 0 _, . . ., J_ .


Let _vn_ ( _xn,_ ( _In_ _[j]_ [)] _[J]_ _j_ =0 _[, f][n]_ [) denote the value function, representing the maximal expected proceeds from liquidat-]
ing _xn_ units over the periods _tn, . . ., tN_, given the current cumulative price impacts and fundamental price.
From (12), the associated Bellman equation reads:



_n_  - + E� _vn_ +1( _xn_ +1 _,_ ( _In_ _[j]_ +1 [)] _j_ _[J]_ =0 _[, f][n]_ [+1][)] _[|][f][n]_  - _._ (21)

_L_



_vn_ ( _xn,_ ( _In_ _[j]_ [)] _[J]_ _j_ =0 _[, f][n]_ [) = sup] _δnfn_ �1 _−_
_δn_



_J_ _√_

- _ωjIn_ _[j]_ _[−]_ _[δ][n]_ _fn_

_L_

_j_ =0



_J_




To satisfy the volume constraint (9), the terminal condition enforces complete liquidation:



_J_ _√_

_vN_ ( _xN_ _,_ ( _IN_ _[j]_ [)] _j_ _[J]_ =0 _[, f][N]_ [) =] _[ x][N]_ _[f][N]_ �1 _−_ - _ωjIN_ _[j]_ _[−]_ _[x][N]_ _fN_

_L_
_j_ =0




_,_ (22)



which corresponds to selling the entire remaining inventory _xN_ at _tN_ in a single trade.


In contrast to Proposition 1, where the dynamics of the fundamental price remain unspecified, solving the
Bellman equation and deriving the value function requires specifying them. We assume that the fundamental
price follows a geometric Brownian motion (17). The explicit value function and optimal control in a closedloop setting are provided in the following proposition.


**Proposition 2** (Dynamic programming: closed-loop solution) **.** _Under the geometric Brownian motion as-_
_sumption_ (17) _, the value function reads:_



_J_

- _Fn_ _[j]_ [1] _[,j]_ [2] _In_ _[j]_ [1] _[I]_ _n_ _[j]_ [2] - _,_ (23)

_j_ 2=0



_J_



_j_ 1=0



_fn_ �+ ~~�~~ _fn_ - _Dn_ +



_fn_ �+ ~~�~~




          _vn_ ( _xn,_ ( _In_ _[j]_ [)] _j_ _[J]_ =0 _[, f][n]_ [) =] _[ x][n][f][n]_ _An_ +


_and the optimal control:_



_J_

- _Bn_ _[j]_ _[I]_ _n_ _[j]_ [+] _[C][n][x][n]_ 

_j_ =0



_J_




_J_

- _En_ _[j]_ _[I]_ _n_ _[j]_ [+]


_j_ =0




   _fnθn_ [3] +1 _,_ (24)



1
_δn_ _[∗]_ [(] _[x][n][,]_ [ (] _[I]_ _n_ _[j]_ [)] _j_ _[J]_ =0 _[, f][n]_ [) =] ~~_√_~~
2 _ϕn_ +1 _fn_



_J_





- _In_ _[j]_ _[θ]_ _n_ [2] _[,j]_ +1 [+] _[ x][n]_ ~~�~~

_j_ =0




_θn_ [1] +1 [+]



_where the coefficients ϕn_ +1 _, θn_ [1] +1 _[,]_ - _θn_ [2] _[,j]_ +1 [1] - _Jj_ 1=0 _[and][ θ]_ _n_ [3] +1 _[are defined as:]_



2 _[µ]_ [+] [3] _[σ]_ 8 [2]



_J_





- _Fn_ _[j]_ [1] +1 _[,j]_ [2] _[e]_ [(] _[µ]_ 2

_j_ 2=0




_[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2]



8 [)∆] _,_ (25)




[1] [2]

_L_ [+] _L_



_J_




_ϕn_ +1 = [1]



_L_



_L_ [2]




_[σ]_ [2]

8 [)∆] _−_ [4]



_J_



_j_ 1=0




- _Bn_ _[j]_ +1 _[e]_ [(] _[µ][−][ρ][j]_ [)∆] _[−]_ _[C][n]_ [+1] _[e]_ [(] [3] 2 _[µ]_

_j_ =0



_and,_




_[µ]_ 2 _[−][ρ][j]_ _[−]_ _[σ]_ 8 [2]



8 [)∆] _,_



_θn_ [1] +1 [= 1] _[ −]_ _[A][n]_ [+1] _[e][µ]_ [∆] [+] [2]

_L_



_J_





- _En_ _[j]_ +1 _[e]_ [(] _[µ]_ 2

_j_ =0




_[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2]



8 [)∆] _,_



_θn_ [2] _[,j]_ +1 [1] [=] _[ −][ω][j]_ 1 _[−]_ _[B]_ _n_ _[j]_ [1] +1 _[e]_ [(] _[µ][−][ρ][j]_ [1] [)∆] [+] [4]

_L_



_J_





- _Fn_ _[j]_ [1] +1 _[,j]_ [2] _[e]_ [(] _[µ]_ 2

_j_ 2=0



(26)



2 _[µ]_ [+] [3] _[σ]_ 8 [2]



8 [)∆] _._



_θn_ [3] +1 [=] [2]

_L_



_J_





- _Bn_ _[j]_ +1 _[e]_ [(] _[µ][−][ρ][j]_ [)∆] _[−]_ [2] _[C][n]_ [+1] _[e]_ [(] [3] 2 _[µ]_

_j_ =0



7


_The coefficients An,_ ( _Bn_ _[j]_ [)] _[J]_ _j_ =0 _[, C][n][, D][n][,]_ [ (] _[E][n]_ [)] _j_ _[J]_ =0 _[and]_ [ (] _[F][n]_ [)] _j_ _[J]_ 1 _,j_ 2=0 _[are determined recursively as follows:]_
 _BCAnnn_ _[j]_ = = [=] _C A_ _[ B]_ _nnn_ _[j]_ +1+1+1 _ee_ _[e]_ [(] _[µ]_ [(] _[µ]_ [3][∆] 2 _[µ][−]_ [+] + _[ρ][j]_ [3][)∆] _[σ]_ 82 [2] _ϕ_ [)∆] _n_ 1 [+] +1+2 _[θ]_ _ϕn_ [1] _n_ 14+1+1 _ϕn_ 1 _[θ][θ]_ +1 _n_ [3] _n_ [2] _[,j]_ +1+1 [(] _[θ]_ _n_ [3] _[θ]_ +1 _n_ [3] +1 [)][2]



(27)



_An_ = _An_ +1 _e_ _[µ]_ [∆] + 2 _ϕn_ 1+1 _[θ]_ _n_ [1] +1 _[θ]_ _n_ [3] +1
_Bn_ _[j]_ [=] _[ B]_ _n_ _[j]_ +1 _[e]_ [(] _[µ][−][ρ][j]_ [)∆] [+] 2 _ϕn_ 1+1 _[θ]_ _n_ [2] _[,j]_ +1 _[θ]_ _n_ [3] +1
_Cn_ = _Cn_ +1 _e_ [(] [3] 2 _[µ]_ [+] [3] _[σ]_ 8 [2] [)∆] + 1 [(] _[θ]_ _n_ [3] +1 [)][2]




[3] 2 _[µ]_ [+] [3] _[σ]_ 8 [2]



8 [)∆] + 4 _ϕn_ 1+1 [(] _[θ]_ _n_ [3] +1 [)][2]







_Dn_ = _Dn_ +1 _e_ [(] _[µ]_ 2

_En_ _[j]_ [=] _[ E]_ _n_ _[j]_ +1 _[e]_ [(] _[µ]_ 2



_En_ _[j]_ [=] _[ E]_ _n_ _[j]_ +1 _[e]_ [(] _[µ]_ 2 _[−][ρ][j]_ _[−]_ _[σ]_ 8 [)∆] + 2 _ϕn_ 1+1 _[θ]_ _n_ [1] +1 _[θ]_ _n_ [2] _[,j]_ +1

_Fn_ _[j]_ [1] _[,j]_ [2] = _Fn_ _[j]_ [1] +1 _[,j]_ [2] _[e]_ [(] _[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2] [)∆] + 4 _ϕn_ 1+1 _[θ]_




_[µ]_ 2 _[−]_ _[σ]_ 8 [2]



8 [)∆] + 4 _ϕn_ 1+1 [(] _[θ]_ _n_ [1] +1 [)][2]



8 [)∆] + 4 _ϕn_ 1+1 _[θ]_ _n_ [2] _[,j]_ +1 [1] _[θ]_ _n_ [2] _[,j]_ +1 [2] _[,]_




_[µ]_ 2 _[−][ρ][j]_ _[−]_ _[σ]_ 8 [2]




_[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2]



_with terminal conditions AN_ = 1 _, BN_ _[j]_ [=] _[ −][ω][j][,][ C][N]_ [ =] _[ −]_ _L_ [1] _[,][ D][N]_ [ =] _[ E]_ _N_ _[j]_ [=] _[ F]_ _N_ _[ j]_ [1] _[,j]_ [2] = 0 _._



Details on the derivation are provided in Appendix A. Whereas the general solution from Proposition 1 is
static, the closed-loop solution is dynamic as it adjusts its execution path in response to price feedback.


We now turn to the open-loop formulation of the execution problem (12). The fundamental price is removed
from the set of state variables and the problem is reformulated in expectation under the geometric Brownian motion assumption (17). Consequently, the strategy does not incorporate feedback from the evolving
fundamental price during execution. We introduce _I_ [˜] _n_ _[j]_ [the cumulative mean price impact at time] _[ t][n]_ [induced]
by the _j_ -th resilience factor, for _j_ = 0 _, . . ., J_ . The dynamics are:

         - _I_ ˜0 _j_ [= 0] ~~_√_~~
_I_ ˜ _n_ _[j]_ +1 [=] _[ e][−]_ [∆] _[ρ][j]_                  - _I_ ˜ _n_ _[j]_ [+] [2] _[δ][n]_ _L_ _f_ 0 _e_ [(] _[µ]_ 2 [+] [3] _[σ]_ 8 [2] [)] _[n]_ [∆][�] _._ (28)




_[σ]_ [2] (28)

8 [)] _[n]_ [∆][�] _._




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



Inventory also evolves according to (19).


Next, we denote the value function by ˜ _v_, and the Bellman equation reads:



0 _e_ [(] _[µ]_ 2

_L_




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



8 [)] _[n]_ [∆][�] + ˜ _vn_ +1( _xn_ +1 _,_ ( _I_ [˜] _n_ _[j]_ +1 [)] _j_ _[J]_ =0 [)] _[.]_ (29)



_v_ ˜ _n_ ( _xn,_ ( _I_ [˜] _n_ _[j]_ [)] _j_ _[J]_ =0 [) = sup] _δnf_ 0 _e_ _[µn]_ [∆][�] 1 _−_
_δn_



_J_ _√_

- _ωjI_ [˜] _n_ _[j]_ _[−]_ _[δ][n]_ _f_ 0

_L_

_j_ =0



_J_




To satisfy the volume constraint (9), the terminal condition also enforces complete liquidation:




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



8 [)] _[N]_ [∆][�] _._ (30)



_v_ ˜ _N_ ( _xN_ _,_ ( _I_ [˜] _N_ _[j]_ [)] _j_ _[J]_ =0 [) =] _[ x][N]_ _[f]_ [0] _[e][µN]_ [∆][�] 1 _−_



_J_ _√_

- _ωjI_ [˜] _N_ _[j]_ _[−]_ _[x][N]_ _f_ 0 _e_ [(] _[µ]_ 2

_L_
_j_ =0



_J_




The explicit value function and optimal control in the open-loop setting are provided in the following proposition.


**Proposition 3** (Dynamic programming: open-loop solution) **.** _Under the geometric Brownian motion as-_
_sumption_ (17) _, the value function reads:_



_f_ 0� + ~~�~~



_J_



_j_ 1=0



_J_

- _F_ ˜ _n_ _[j]_ [1] _[,j]_ [2] _I_ ˜ _n_ _[j]_ [1] _[I]_ [˜] _n_ _[j]_ [2] - _,_ (31)

_j_ 2=0



_J_

- _E_ ˜ _n_ _[j]_ _[I]_ [˜] _n_ _[j]_ [+]

_j_ =0



_v_ ˜ _n_ ( _xn,_ ( _I_ [˜] _n_ _[j]_ [)] _[J]_ _j_ =0 [) =] _[ x][n][f]_ [0] - _A_ ˜ _n_ +


_and the optimal control:_



_J_





- _B_ ˜ _n_ _[j]_ _[I]_ [˜] _n_ _[j]_ [+ ˜] _[C][n][x][n]_ ~~�~~

_j_ =0



_f_ 0� _D_ ˜ _n_ +




   _f_ 0 _θ_ [˜] _n_ [3] +1 _,_ (32)



1
_δn_ _[∗]_ [(] _[x][n][,]_ [ (˜] _[I]_ _n_ _[j]_ [)] _[J]_ _j_ =0 [) =] ~~_√_~~
2 _ϕ_ [˜] _n_ +1 _f_ 0



_J_





- _I_ ˜ _n_ _[j]_ _[θ]_ [˜] _n_ [2] _[,j]_ +1 [+] _[ x][n]_ ~~�~~

_j_ =0




- _θ_ ˜ _n_ [1] +1 [+]


8


_where the coefficients_ _ϕ_ [˜] _n_ +1 _,_ _θ_ [˜] _n_ [1] +1 _[,]_ - _θ_ ˜ _n_ 2 _,j_ +11 - _Jj_ 1=0 _[and]_ [ ˜] _[θ]_ _n_ [3] +1 _[are defined as:]_




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



_J_





- _F_ ˜ _n_ _[j]_ [1] +1 _[,j]_ [2] _[e][−]_ [(] _[ρ][j]_ [1] [+] _[ρ][j]_ [2] [)∆] _[e]_ [(] _[µ]_ [+] [3] _[σ]_ 4 [2]

_j_ 2=0



4 [)] _[n]_ [∆] _,_



_ϕ_ ˜ _n_ +1 = [1]



_J_




2 _[µ]_ [+] [3] _[σ]_ 8 [2]



_L_ [2]




[3] 2 _[µ]_
_L_ _[e]_ [(]




_[σ]_ [2]

8 [)] _[n]_ [∆] + [2]



_L_




_[σ]_ [2]

8 [)] _[n]_ [∆] _−_ _C_ ˜ _n_ +1 _−_ [4]



_J_



_j_ 1=0




- _B_ ˜ _n_ _[j]_ +1 _[e][−][ρ][j]_ [∆] _[e]_ [(] _[µ]_ 2

_j_ =0



(33)
_and,_




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



8 [)] _[n]_ [∆] _,_



_θ_ ˜ _n_ [1] +1 [=] _[ e][µn]_ [∆] _[−]_ _[A]_ [˜] _[n]_ [+1] [+] [2]

_L_



_J_





- _E_ ˜ _n_ _[j]_ +1 _[e][−][ρ][j]_ [∆] _[e]_ [(] _[µ]_ 2

_j_ =0




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



8 [)] _[n]_ [∆] _,_



_θ_ ˜ _n_ [2] _[,j]_ +1 [1] [=] _[ −][ω][j]_ 1 _[e][µn]_ [∆] _[−]_ _[B]_ [˜] _n_ _[j]_ [1] +1 _[e][−][ρ][j]_ [1] [∆] [+] [4]

_L_



_J_





- _F_ ˜ _n_ _[j]_ [1] +1 _[,j]_ [2] _[e][−]_ [(] _[ρ][j]_ [1] [+] _[ρ][j]_ [2] [)∆] _[e]_ [(] _[µ]_ 2

_j_ 2=0




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



8 [)] _[n]_ [∆] _−_ 2 ˜ _Cn_ +1 _._



_θ_ ˜ _n_ [3] +1 [=] [2]

_L_



_J_





- _B_ ˜ _n_ _[j]_ +1 _[e][−][ρ][j]_ [∆] _[e]_ [(] _[µ]_ 2

_j_ =0



_The coefficients_ _A_ [˜] _n,_ ( _B_ [˜] _n_ _[j]_ [)] _[J]_ _j_ =0 _[,]_ [ ˜] _[C][n][,]_ [ ˜] _[D][n][,]_ [ ( ˜] _[E][n]_ [)] _[J]_ _j_ =0 _[and]_ [ ( ˜] _[F][n]_ [)] _j_ _[J]_ 1 _,j_ 2=0 _[are determined recursively as follows:]_
 _BCA_ ˜˜˜ _nnn_ _[j]_ = ˜ = ˜ [= ˜] _CA_ _[B]_ _nnn_ _[j]_ +1+1+1 + + _[e][−][ρ]_ 2 _[j]_ _ϕ_ [˜][˜][∆] 1 _n_ 1+1 [+][(˜] _θ_ ˜2 _[θ]_ _n_ [1] _ϕ_ [˜] _n_ [3] +1 _n_ 1+1+1 _[θ]_ [˜][)] _n_ [3] _θ_ ˜ [2] +1 _n_ [2] _[,j]_ +1 _[θ]_ [˜] _n_ [3] +1



(34)


(35)



_A_ ˜ _n_ = ˜ _An_ +1 + 2 _ϕ_ [˜] _n_ 1+1 _θ_ ˜ _n_ [1] +1 _[θ]_ [˜] _n_ [3] +1
_B_ ˜ _n_ _[j]_ [= ˜] _[B]_ _n_ _[j]_ +1 _[e][−][ρ][j]_ [∆] [+] 2 _ϕ_ [˜] _n_ 1+1 _θ_ ˜ _n_ [2] _[,j]_ +1 _[θ]_ [˜] _n_ [3] +1
_C_ ˜ _n_ = ˜ _Cn_ +1 + 4 _ϕ_ [˜] _n_ 1+1 [(˜] _[θ]_ _n_ [3] +1 [)][2]







_D_ ˜ _n_ = ˜ _Dn_ +1 + 4 _ϕ_ [˜] _n_ 1+1 [(˜] _[θ]_ _n_ [1] +1 [)][2]



_E_ ˜ _n_ _[j]_ [= ˜] _[E]_ _n_ _[j]_ +1 _[e][−][ρ][j]_ [∆] [+] 2 _ϕ_ [˜] _n_ 1+1 _θ_ ˜ _n_ [1] +1 _[θ]_ [˜] _n_ [2] _[,j]_ +1
_F_ ˜ _n_ _[j]_ 1 _[,j]_ 2 = _F_ [˜] _n_ _[j]_ [1] +1 _[,j]_ [2] _[e][−]_ [(] _[ρ][j]_ [1] [+] _[ρ][j]_ [2] [)∆] [+] 4 _ϕ_ [˜] _n_ 1+1 _θ_ ˜ _n_ [2] _[,j]_ +1 [1] _[θ]_ [˜] _n_ [2] _[,j]_ +1 [2] _[,]_



_L_ [1] _[e]_ [(] _[µ]_ 2




_[σ]_

8 [)] _[N]_ [∆] _,_ _D_ [˜] _N_ = _E_ [˜] _N_ _[j]_ [= ˜] _[F][ j]_ _N_ [1] _[,j]_ [2] = 0 _._



_with terminal conditions_ _A_ [˜] _N_ = _e_ _[µN]_ [∆] _,_ _B_ [˜] _N_ _[j]_ [=] _[ −][ω][j][e][µN]_ [∆] _[,]_ [ ˜] _[C][N]_ [ =] _[ −]_ _L_ [1]




_[µ]_ 2 [+] [3] _[σ]_ 8 [2]



The open-loop solution is set at time _t_ 0 and is not adjusted during execution as in the general solution of
Proposition 1. In particular, when the fundamental price follows a geometric Brownian motion, numerical
experiments show that the open-loop solution coincides with the solution of Corollary 2, which is unsurprising.
An analogous result is established by Alfonsi et al. (2010) in a distinct framework. Here, the recursive scheme
is more complex and prevents a similar derivation.


**2.3** **Numerical results**


**2.3.1** **Illustrations**


We illustrate the optimal trading strategy when the fundamental price follows a geometric Brownian motion
using the closed-form expression of Corollary 2 with the following set of parameters: _T_ = 1, _N_ = 10, _ξ_ = 1,
_f_ 0 = 1, _L_ = 1000, _µ_ = 0 and _σ_ = 0 _._ 3. In the single-kernel setting, the closed-form inverse of _A_ given in (18) is
used, whereas in the general multi-kernel case, it is computed numerically. Three scenarios are investigated
and Figure 1 displays the corresponding optimal execution schedules. We compare them to classical ones
from the LOB literature. Even though our focus is on optimal execution on CPAMMs, comparisons with
the LOB literature remain relevant as CPAMMs can be seen as LOBs with virtual shape functions (Tran
et al., 2024).


**Scenario 1 (exponential resilience)** We first examine exponential resilience with no permanent impact,
setting _J_ = 0 and _ρ_ = 3. With a single exponential kernel (i.e., _J_ = 0), the index _j_ in (10) is omitted. The
resulting optimal strategy exhibits features reminiscent of a bucket-shaped profile, characterized by identical
trades at the beginning and end of the trading horizon, and smaller constant sized trades in between. A


9


Figure 1: Optimal execution schedule under the three scenarios (relative to the initial trade for the sake of
comparison); _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ = 1000, _f_ 0 = 1, _µ_ = 0 and _σ_ = 0 _._ 3.


symmetric bucket-shaped profile was originally observed in Obizhaeva and Wang (2013) without risk aversion.
However, the bucket-shaped profile obtained here is asymmetric, with the initial trade larger than the final
one. Appendix B establishes this property and studies the sensitivity of the strategy to model parameters,
both within a two-period framework. Moreover, the intermediate trades are not equal and exhibit a slight
downward slope, a feature also observed in Obizhaeva and Wang (2013) when risk aversion is included in
the objective function. We recover a similar pattern here despite the absence of risk aversion. We interpret
this behavior as a consequence of stochastic price impact and slippage, which introduces uncertainty into
execution. This asymmetry becomes more pronounced as the volatility parameter increases, reflecting a
stronger incentive to front-load execution because of higher expected price impact and slippage of future
trades (see Section 2.3.2).


**Scenario 2 (power-law resilience)** Next, a power-law-like resilience with no permanent impact is considered. The power-law kernel is approximated by a convex combinations of exponential kernels:



(1 + _αm_ ∆) _[−][β]_ _≈_



_J_

- _ωje_ _[−][ρ][j]_ _[m]_ [∆] _,_ (36)


_j_ =0



where _α ≥_ 0 is a scaling parameter and _β ≥_ 0 denotes the power-law exponent. Given _α_ and _β_, the
resilience parameters ( _ρj_ ) _[J]_ _j_ =0 [and the associated weights (] _[ω][j]_ [)] _j_ _[J]_ =0 [are obtained numerically by fitting the]
power-law kernel over the interval [0 _, T_ ]. To do so, we use the SLSQP algorithm provided by the Scipy
_minimize_ function. We set _α_ = 10 and _β_ = 0 _._ 8. In this setting, we take _J_ = 1, which provides an
accurate approximation of the power-law kernel. An advanced calibration methodology for larger values of
_J_ is presented in Bochud and Challet (2007). The optimal execution schedule exhibits an asymmetric Ushaped profile, with trade sizes gradually increasing toward both ends of the trading interval. A symmetric
U-shape profile is presented in Bouchaud et al. (2018, Section 21.2) and obtained under power-law decaying
propagators without risk aversion whereas an asymmetric U-shape profile is obtained in Busseti and Lillo
(2012) by incorporating risk aversion. As in Scenario 1, we obtain an asymmetric profile despite the absence
of risk aversion. This asymmetry also arises from the stochastic nature of market impact and slippage in our
CPAMM framework.


**Scenario 3 (predominant permanent impact)** Finally, we consider a scenario under predominant
permanent impact and limited exponential resilience, with parameters: _J_ = 1, _ω_ 0 = 0 _._ 99, _ρ_ 0 = 0, _ω_ 1 = 0 _._ 01
and _ρ_ 1 = 5. The resulting optimal execution schedule is close to a front-loaded profile, in the spirit of the


10


(a) Influence of _σ_ ; _ρ_ = 3





(b) Influence of _ρ_ ; _σ_ = 0 _._ 3


Figure 2: Influence of the parameters on the optimal execution schedule under scenario 1 (exponential
resilience); _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ = 1000, _f_ 0 = 1, _µ_ = 0 and _J_ = 0.


Almgren-Chriss schedule under a mean-variance objective (Almgren and Chriss, 2001). Despite the frontloaded nature of the schedule, the final trade remains significant relative to the previous ones, resulting in a
hybrid between a front-loaded and a bucket-shaped profile.


**2.3.2** **Sensitivity analysis**


**Influence of the volatility** In the single-kernel case ( _J_ = 0), corresponding to scenario 1 (exponential
resilience), Figure 2a illustrates the influence of the volatility parameter _σ_ . As the volatility increases, the
execution profile skews toward the beginning of the trading schedule. Indeed, the model allocates larger
trade sizes at earlier stages, at the expense of the terminal ones. This behavior reflects the incentive of the
trader to front-load execution because of higher expected price impact of future trades.


**Influence of the resilience** Still under scenario 1 (exponential resilience) in the single-kernel setting
( _J_ = 0), Figure 2b shows the influence of the resilience parameter _ρ_ on the execution profile. As the resilience increases, the execution profile exhibits an upward parallel shift centered on the intermediate trades.
Both the initial and terminal trades decrease in size, while intermediate trades are amplified. This shift


11


(a) Influence of _β_ under scenario 2 (power-law resilience)





(b) Influence of _ω_ 0 under scenario 3 (predominant permanent impact); _ρ_ 0 = 0, _ρ_ 1 = 5


Figure 3: Influence of the parameters on the optimal execution schedule; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ = 1000,
_f_ 0 = 1, _µ_ = 0, _σ_ = 0 _._ 3 and _J_ = 1.


12


(a) Execution profiles


(b) Inventory paths



Figure 4: Influence of the trading frequency on the optimal execution schedule under scenario 1 (exponential
resilience); _T_ = 1, _ξ_ = 1, _L_ = 1000, _f_ 0 = 1, _µ_ = 0, _σ_ = 0 _._ 3, _J_ = 0 and _ρ_ = 3.


enables the strategy to benefit from a stronger mean-reverting effect in prices, thereby reducing overall
impact. Then, Figure 3a illustrates the influence of the power-law exponent _β_ in the two-kernels setting
( _J_ = 1), corresponding to scenario 2 (power-law resilience). The resilience parameters are calibrated via the
procedure described in Section 2.3.1. As _β_ increases, the model also increases the size of the intermediary
trades. Moreover, a higher _β_ concentrates the resilience dynamics around a single dominant factor, thereby
flattening the U-shaped profile. Finally, Figure 3b examines the effect of the permanent component of price
impact under scenario 3 (predominant permanent impact). As the permanent impact becomes increasingly
predominant, the execution strategy shifts toward a more front-loaded profile. When impact is fully permanent (i.e., _ω_ 0 = 1), the optimal strategy consists in liquidating the entire inventory at the first time step, as
no mean-reverting effect remains to be exploited.


**Influence of the trading frequency** Figures 4a, 4b display the effect of the trading frequency _N_ on both
the optimal execution profile and the resulting inventory path in the scenario 1 (exponential resilience). As
_N_ increases, all intermediary trades decrease uniformly, and both the initial and final trades also decrease.
Nevertheless, the overall structure of the strategy remains unchanged: the inventory paths intersect at all
common time steps, indicating that the underlying execution dynamics are preserved.


13


(a) Influence of _L_ ; _µ_ = 0 _._ 001


(b) Influence of _L_ ; _µ_ = _−_ 0 _._ 001



Figure 5: Influence of the liquidity with non-zero drift on the optimal execution schedule under scenario 1
(exponential resilience); _T_ = 1, _N_ = 10, _ξ_ = 1, _f_ 0 = 1, _σ_ = 0 _._ 3, _J_ = 0 and _ρ_ = 3.


14


scenario 1 scenario 2 scenario 3


_E_ [mean] (in basis points) 3 2 2
_E_ [max] (in basis points) 17 9 5


Table 1: Mean and maximum absolute differences between open-loop and closed-loop evaluated along the
mean price trajectory optimal execution schedules; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ = 1000, _f_ 0 = 1, _µ_ = 0 and
_σ_ = 0 _._ 3.


**Influence of the liquidity** While liquidity has no impact on the optimal strategy in the martingale
setting, it plays a significant role when the drift is non-zero. This effect is illustrated in Figures 5a, 5b.
When the drift is positive, the optimal strategy reduces the size of the early trades and favors liquidation
closer to maturity in order to benefit from the expected price increase induced by the positive drift. As the
liquidity of the pool increases, the strategy further decreases the size of the early trades, and once liquidity
is sufficiently high, the strategy involves buying at the beginning of the period and unwinding the position
at maturity. When the drift is negative the reasoning is reversed and the strategy tends to sell more at the
beginning of the period and buy back at maturity in order to benefit from the expected price decrease.


**2.3.3** **Open-loop versus closed-loop**


First, we compare the optimal strategy obtained in the open-loop setting, as formulated in Proposition 3, with
the closed-loop counterpart from Proposition 2 evaluated along the mean fundamental price trajectory. We
compute the mean and maximum absolute differences (expressed in basis points) across the three scenarios
introduced in Section 2.3.1, as summarized in Table 1. The mean and maximum absolute differences, denoted
respectively by _E_ [mean] and _E_ [max], are computed as:



1
_E_ [mean] =
_N_ + 1



_N_



_n_ =0



��� _δn∗_ - _xn,_ ( _In_ _[j]_ [)] _j_ _[J]_ =0 _[, f]_ [0] _[e][µn]_ [∆][�] _−_ _δ_ [˜] _n_ _[∗]_ [(] _[x][n][,]_ [ (˜] _[I]_ _n_ _[j]_ [)] _j_ _[J]_ =0 [)] ��� _,_ (37)



_E_ [max] = max
_n_ =0 _,...,N_



��� _δn∗_ - _xn,_ ( _In_ _[j]_ [)] _j_ _[J]_ =0 _[, f]_ [0] _[e][µn]_ [∆][�] _−_ _δ_ [˜] _n_ _[∗]_ [(] _[x][n][,]_ [ (˜] _[I]_ _n_ _[j]_ [)] _j_ _[J]_ =0 [)] ��� _._ (38)



Both the remaining inventory and the cumulative price impacts are computed forward in time according
to their respective dynamics. Across all three scenarios, the open-loop and closed-loop evaluated along the
mean fundamental price trajectory strategies yield similar results.


Second, under scenario 1 (exponential resilience) from Section 2.3.1, we compare the optimal strategy in the
closed-loop setting evaluated along the mean fundamental price trajectory with those obtained under the
following upward and downward price trajectories:



~~_√_~~

_[σ]_ 2 [2] [)] _[m]_ [∆] _[±]_ [3] _[σm]_



_fm_ _[±]_ [=] _[ f]_ [0] _[e]_ [(] _[µ][−]_ _[σ]_ 2 [2]



∆ _._ (39)



Figure 6a presents the resulting execution schedules. At the initial time, the executed trades are identical
across trajectories. As prices diverge from the mean trajectory, the strategy adjusts accordingly. In the
case of a persistently upward trend, it accelerates liquidation to benefit from rising prices. More specifically,
when the observed prices exceed the expected ones, the strategy executes larger trades than it would have
under the mean trajectory, seizing the opportunity to sell at more favorable prices. Conversely, when the
observed price falls below the mean trajectory, the strategy sells less.


Finally, we analyze the optimal strategy under fundamental price trajectories subject to a persistent upward

~~_√_~~

or downward multiplicative price bump _e_ [(] _[µ][−]_ _[σ]_ 2 [2] [)∆] _[±]_ [3] _[σ]_ ∆, applied just before _tn_ = 0 _._ 5. The corresponding




[2] ~~_√_~~

2 [)∆] _[±]_ [3] _[σ]_



or downward multiplicative price bump _e_ [(] _[µ][−]_ 2 [)∆] _[±]_ [3] _[σ]_ ∆, applied just before _tn_ = 0 _._ 5. The corresponding

schedules are displayed in Figure 6b. In this case, the strategy reacts immediately at the time of the shock,
then returns to the initial profile, shifted to account for changes in remaining inventory.



15


(a) Execution under mean, upward and downward price trajectories


(b) Execution under mean, upward and downward bumped price trajectories



Figure 6: Closed-loop optimal execution schedules evaluated along mean, upward and downward price
trajectories; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ = 1000, _f_ 0 = 1, _µ_ = 0, _σ_ = 0 _._ 3, _J_ = 0 and _ρ_ = 3.


16


Figure 7: Illustration of the two-layer liquidity profile. For a given trade size, the dashed zone indicates
the price interval where the trade may cause the spot price to cross from the high-liquidity layer to the
low-liquidity one; _L_ 0 = 1000, _L_ 1 = 500, _f_ 0 = 1 and ~~_p_~~ = 0 _._ 95.


**2.4** **Incorporating fees**


In this section, we discuss the integration of a swap fee _ϕ_ into the execution framework, the constant product
formula (3) now reads:
( _q_ _[a]_ + (1 _−_ _ϕ_ ) _δ_ _[a]_ )( _q_ _[b]_ _−_ _δ_ _[b]_ ) = _L_ [2] _._ (40)


In Uniswap v2, the swap fee is applied to the input amount and is fixed at _ϕ_ = 0 _._ 3%. After the swap,
liquidity is updated to _L_ [+] = �( _q_ _[a]_ + _δ_ _[a]_ )( _q_ _[b]_ _−_ _δ_ _[b]_ ) to reflect the fee-adjusted reserves. Equation (40) is valid

only for positive trades (i.e., sell orders), since applying it to negative trades (i.e., buy orders) would imply
that fees are received by the trader rather than paid to the pool. In this restricted setting, the optimal
scheduling problem (12) still admits a closed-form solution, with appropriate adjustments to account for
fees. Empirically, for the scenarios considered in Section 2.3, we observe that a fee level of _ϕ_ = 0 _._ 3%
affects cash-flows but has negligible influence on the resulting optimal strategies. Extending the model
to handle negative trades would require adjusting the fee structure depending on the sign of the trade,
which considerably complicates the modeling framework without giving fundamental new insights. For these
reasons, we omit fees in the paper.

### **3 From Uniswap v2 to v3**


**3.1** **A two-layer liquidity framework**


In Uniswap v3, each LP chooses over which price interval they wish to provide liquidity. As a result, liquidity
depends on the spot price in contrast to the constant liquidity of Uniswap v2. Here, we consider a two-layer
liquidity framework, which naturally extends to multiple layers: _L_ 0 when the spot price is above the price
threshold ~~_p_~~ ~~,~~ and _L_ 1 _< L_ 0 when the spot price is below ~~_p_~~ ~~.~~ Figure 7 illustrates the liquidity profile as a function
of the spot price. We consider the same execution problem (12), reformulated within a dynamic programming
framework under a closed-loop setting as in Section 2.2.3. In the two-layer liquidity framework, both cashflows and price impacts depend on whether the spot price is above or below the threshold ~~_p_~~ ~~.~~ A third case
arises when the spot price lies above ~~_p_~~ ~~,~~ but the execution causes it to cross the threshold. In this case, both
the total cash flows and the aggregate price impact are decomposed into two parts: one corresponding to
the execution above the threshold, and the other to the execution below it. The corresponding dynamics of


17


the cumulative price impacts read:



~~_√_~~
_e_ _[−][ρ][j]_ [∆][�] _In_ _[j]_ [+] [2] _[δ][n]_ _L_ 1 _fn_ - if _pn ≤_ ~~_p_~~



_e_ _[−][ρ][j]_ [∆][�] _In_ _[j]_ [+] [2] _[δ][n]_ _L_ ~~_√_~~ 0 _fn_ + [2(] _[δ][n]_ _L_ _[δ]_ 1 _[n]_ [)] ~~_[p]_~~ - if _pn >_ ~~_p_~~ and _δn > δn_

_e_ _[−][ρ][j]_ [∆][�] _In_ _[j]_ [+] [2] _[δ][n]_ _L_ 0 _fn_ - if _pn >_ ~~_p_~~ and _δn ≤_ _δn,_



_In_ _[j]_ +1 [=]











~~_√_~~ 1
_e_ _[−][ρ][j]_ [∆][�] _In_ _[j]_ [+] [2] _[δ][n]_ _L_ ~~_√_~~ 0 _fn_ + [2(] _[δ][n][−]_ _L_ _[δ]_ 1 _[n]_ [)] ~~_[√][p]_~~



(41)



for _j_ = 0 _, . . ., J_ where _I_ 0 _[j]_ [= 0 and the quantity] _[ δ][n]_ [ corresponds to the trade size that brings the post-swap]
price down to the threshold ~~_p_~~ ~~,~~ starting from an initial spot price above the threshold:



_δn_ = _L_ ~~_√_~~ 0
2 _fn_ _fn_




- _pn −_ ~~_p_~~ - _._ (42)



The dynamics of the inventory remain unchanged from Section 2.2.3.


In this framework, the Bellman equation reads:


                         -                         _vn_ ( _xn,_ ( _In_ _[j]_ [)] _[J]_ _j_ =0 _[, f][n]_ [) = sup] _Cn_ + E _vn_ +1( _xn_ +1 _,_ ( _In_ _[j]_ +1 [)] _j_ _[J]_ =0 _[, f][n]_ [+1][)] _[|][f][n]_ _,_ (43)
_δn_


where the cash-flow at time _tn_ is:



~~_√_~~
_δnfn_ �1 _−_ [�] _[J]_ _j_ =0 _[ω][j][I]_ _n_ _[j]_ _[−]_ _[δ][n]_ _L_ 1 _fn_ - if _pn ≤_ ~~_p_~~



~~_√_~~ 1
_δnfn_ �1 _−_ [�] _[J]_ _j_ =0 _[ω][j][I]_ _n_ _[j]_ _[−]_ _[δ][n]_ _L_ 0 _fn_ - if _pn >_ ~~_p_~~ and _δn ≤_ _δn._




_[δ][n]_ [)] ~~_[√][p]_~~  - if _pn >_ ~~_p_~~ and _δn > δn_

_L_ 1



_Cn_ =











~~_√_~~ 1
_δnfn_ �1 _−_ [�] _[J]_ _j_ =0 _[ω][j][I]_ _n_ _[j]_ _[−]_ _[δ][n]_ _L_ 0 _fn_ 


0

+ ( _δn −_ _δn_ ~~)~~ ~~_p_~~ �1 _−_ [�] _[J]_ _j_ =0 _[ω][j][I]_ _n_ _[j]_ _[−]_ [(] _[δ][n][−]_ _L_ _[δ]_ 1 _[n]_ [)] ~~_[√][p]_~~



(44)



To satisfy the volume constraint (9), the terminal condition of the value function enforces complete liquidation
using _δN_ = _xN_ in (44).


Because of the discontinuities in the model, closed-form expressions are no longer available. Therefore, in
the following section, we present a numerical method to approximate the optimal strategy.


**3.2** **Discretization scheme**


We present a numerical method to approximate the value function and the corresponding optimal control
under the two-layer liquidity framework introduced in Section 3.1. We also assume that the fundamental
price follows a geometric Brownian motion, as described in Section 2.2.3. We adopt a discretization scheme,
starting with the price domain. The price grid is defined for _kf ∈{_ 0 _, . . ., Kf_ _}_ as:




             - 2 _kf −_ _Kf_
_f_ [(] _[k][f]_ [ )] = _e_ _[Y]_ [ (] _[kf]_ [ )] _,_ _Y_ [(] _[k][f]_ [ )] = _mT_ + _zσT_

_Kf_




_,_ (45)



_√_

[2]

2 [)] _[T]_ [ and] _[ σ][T]_ [ =] _[ σ]_



where _z >_ 0 controls the grid width, while _mT_ = log( _f_ 0)+( _µ_ _−_ _[σ]_ [2]



where _z >_ 0 controls the grid width, while _mT_ = log( _f_ 0)+( _µ_ _−_ 2 [)] _[T]_ [ and] _[ σ][T]_ [ =] _[ σ]_ _T_ correspond to the mean

and standard deviation of the log-price at maturity. An alternative would be to use adaptive grids based on
the mean and standard deviation of the log-price over time. We tested both fixed and adaptive grids: fixed
grids yield more stable numerical results.


Next, we discretize the inventory and cumulative price impact spaces. For _kx ∈{_ 0 _, . . ., Kx}_, the inventory
grid is defined by:

_x_ [(] _[k][x]_ [)] = _[k][x][ξ]_ _,_ (46)

_Kx_

and for _ki_ _[j]_ _[∈{]_ [0] _[, . . ., K][I]_ _[}]_ [, the grid associated with the cumulative impact induced by the] _[ j]_ [-th resilience factor]
is given by:




    _I_ [(] _[k]_ _i_ _[j]_ [)] = _e_ _[−][ρ][j]_ [∆] [2] _[k]_ _i_ _[j][ξ]_



_f_ [(] _[K][f]_ [ )]



_._ (47)
_L_ 1 _KI_



18


To approximate the conditional expectation in the Bellman equation, we introduce log-price midpoints
between each _Y_ [(] _[k][f]_ [ )] :
_y_ [(] _[k]_ _f_ _[±]_ [)] = [1]                  - _Y_ [(] _[k][f]_ [ )] + _Y_ [(] _[k][f][ ±]_ [1)][�] _,_ (48)

2

with boundary values _y_ [(0] _[−]_ [)] = _−∞_ and _y_ [(] _[K]_ _f_ [+][)] = + _∞_ to encompass the entire price domain. Given a current
price _f_ [(] _[k]_ [)], the conditional expectation of the value function at the next time step is approximated by:



E� _vn_ +1( _xn_ +1 _,_ ( _In_ _[j]_ +1 [)] _j_ _[J]_ =0 _[, f][n]_ [+1][)] _[|][f][n]_ [=] _[ f]_ [ (] _[k]_ [)][�] _≈_



_Kf_

- _ωk→qvn_ +1( _xn_ +1 _,_ ( _In_ _[j]_ +1 [)] _j_ _[J]_ =0 _[, f]_ [ (] _[q]_ [)][)] _[,]_ (49)

_q_ =0



where the transition probability weights _ωk→q_ are computed as:




_[ −]_ _[µ][k]_

) _−_ Φ( _[y]_ [(] _[q][−]_ [)] _[ −]_ _[µ][k]_
_s_ _s_



_ωk→q_ = Φ( _[y]_ [(] _[q]_ [+)] _[ −]_ _[µ][k]_



) _,_ (50)
_s_



_√_

[2]

2 [)∆,] _[ s]_ [ =] _[ σ]_



with _µk_ = log( _f_ [(] _[k]_ [)] ) + ( _µ −_ _[σ]_ [2]



with _µk_ = log( _f_ ) + ( _µ −_ 2 [)∆,] _[ s]_ [ =] _[ σ]_ ∆and Φ denotes the standard normal cumulative distribution

function.


The algorithm proceeds backward in time. The terminal condition of the value function is given by (44) using
_δN_ = _xN_ . Then, starting from this terminal condition and applying the Bellman recursion, we estimate the
value function and the corresponding optimal control at each grid point of the fundamental price, inventory
and cumulative impacts, using the approximation of the conditional expectation (49). Moreover, for a given
inventory level indexed by _kx_, the supremum in the Bellman equation (43) is evaluated over a discrete set
of trade sizes drawn from the inventory grid: _x_ [(] _[k]_ [)] for _k ∈_ 0 _, . . ., kx_ . This restriction enforces non-negativity
of trades, thereby introducing no-buy constraints into the optimization. This design choice is motivated by
computational efficiency and by the empirical observation that none of the optimal profiles in the martingale
case involve buy orders (see Section 2.3). We therefore restrict the use of the algorithm to the martingale case
( _µ_ = 0). Taking _µ ̸_ = 0 and allowing for buy orders would simply require extending the grid over which the
supremum is computed. Appendix C provides a pseudocode of the backward algorithm. In Appendix D, we
present consistency checks within the Uniswap v2 framework to empirically validate our numerical method.
Specifically, we compare the numerical results in the particular case where _L_ 0 = _L_ 1 with the closed-form
solution derived in Section 2.2.3, both evaluated along the mean price trajectory. Results show that the
discretization scheme yields accurate estimates of the optimal strategy in the Uniswap v2 framework.


**3.3** **Numerical results**


Let us analyze the impact of the threshold price ~~_p_~~ relative to the initial price _f_ 0 on the optimal execution
strategy evaluated along the mean price trajectory. The schedules are computed using the discretization
scheme described in Section 3.2, and correspond to the solution to the dynamic programming problem under
the two-layer liquidity profile introduced in Section 3.1. We adopt a grid resolution of _Kf_ = 500, _Kx_ = 250
and _KI_ = 500. In Appendix D, we vary the grid sizes to assess the stability of the numerical scheme. The
threshold level is expressed in terms of a spread ~~_s_~~, defined by:


~~_p_~~ = _f_ 0 + ~~_s_~~ _._ (51)


We distinguish three regimes depending on the position of the threshold ~~_p_~~ relative to the initial price _f_ 0.


**Low price threshold regime** In Figure 8a, we present the execution strategies for spreads ranging from

_−_ 5000bps to _−_ 100bps. When the threshold price lies far below the initial price ~~(~~ ~~_s_~~ = _−_ 5000bps), the optimal
execution strategy coincides with the strategy obtained in the Uniswap v2 framework. Indeed, the probability
that the price reaches the low-liquidity zone before maturity is very low. Consequently, the model disregards
the discontinuity in liquidity and proceeds as if the pool exhibited constant liquidity. Then, as the threshold


19


(a) Low price threshold regime













(b) Regime with a price threshold close to the initial spot price











(c) High price threshold regime


Figure 8: Influence of the spread ~~_s_~~ on the optimal execution schedule; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ 0 = 1000,
_L_ 1 = 500, _f_ 0 = 1, _µ_ = 0, _σ_ = 0 _._ 3, _J_ = 0, _ρ_ = 3, _Kf_ = 500, _Kx_ = 250 and _KI_ = 500.


20


Figure 9: Influence of _L_ 1 on the optimal execution schedule; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ 0 = 1000, _f_ 0 = 1,
~~_s_~~ = 0, _µ_ = 0, _σ_ = 0 _._ 3, _J_ = 0, _ρ_ = 3, _Kf_ = 500, _Kx_ = 250 and _KI_ = 500.


gradually approaches _f_ 0, the execution strategy progressively front-loads the trades. Indeed, we observe a
skew in the execution profile, with more volume executed in the early steps of the horizon. This adjustment
reflects the increasing probability, driven by price volatility, that the threshold will be crossed before maturity.
In anticipation of the associated cost increase in the low-liquidity regime, the model accelerates execution to
mitigate potential higher slippage and price impact.


**Regime with a price threshold close to the initial spot price** The execution strategies for spreads
ranging from _−_ 100bps to 0bps are reported in Figure 8b. When the threshold level is equal to the initial price
~~(~~ ~~_s_~~ = 0), the optimal execution strategy consists of full liquidation at maturity. As previously mentioned,
the strategy is evaluated along the mean price trajectory, which, in this case, remains at the threshold
throughout the trading horizon. Consequently, the trader holds his position, waiting for a favorable price
movement to benefit from lower costs in the higher-liquidity zone. Figure 9 illustrates the influence of the
lower-layer liquidity parameter _L_ 1 on the optimal strategy. As _L_ 1 approaches _L_ 0, the optimal strategy
gradually transitions from full liquidation at maturity to the Uniswap v2 optimal execution schedule when
_L_ 1 reaches _L_ 0.


**High price threshold regime** Figure 8c illustrates the execution profiles for spreads ranging from 0bps to
5000bps. Strategies for spreads under 100bps are omitted as they yield similar results. When the threshold
price is set above the initial price, the execution strategy shifts again toward earlier liquidation. The
probability of entering the low-liquidity region becomes lower, and the model gradually converges toward the
same constant-liquidity execution profile. Indeed, when the fundamental price is a martingale, the optimal
strategy under constant liquidity is independent of the liquidity level (see Section 2.2).

### **4 Discussion and conclusion**


In this paper, we study the optimal execution problem on AMMs, aiming to maximize the sum of expected
cash-flows under transient price impact. The study covers both CPAMMs (Uniswap v2) and CLAMMs
(Uniswap v3). We derive closed-form solutions under general fundamental price dynamics for CPAMMs,
and analyze the resulting strategies when the fundamental price follows a geometric Brownian motion. We
also solve the reformulated problem within a dynamic programming framework to allow for price feedback
during execution. For CLAMMs, closed-form solutions are no longer available and the optimal strategy
is then approximated numerically using a discretization scheme. The analysis is developed within a twolayer liquidity framework, which naturally extends to multiple layers. Numerical results are obtained using


21


synthetic data. The application to real market data, including the calibration of resilience kernels, will be
conducted in a companion paper.


In the CPAMMs case, exponential resilience leads to an asymmetric bucket-shaped execution profile, while
power-law-like resilience results in an asymmetric U-shaped profile. In the literature, such asymmetries
typically stem from risk aversion. In our setting, they arise from the endogenous and stochastic nature of
market impact and slippage. Incorporating a mean-variance objective function following the approach of
Almgren and Chriss (2001) would enrich the model from a risk-management perspective but would pose
significant mathematical challenges which we leave for future investigation.


The optimal execution strategy on CPAMMs, based on a first-order approximation, is independent of the
liquidity level of the pool in the martingale setting. In contrast, under the two-layer liquidity profile of
CLAMMs, the strategy depends on both the liquidity levels and the position of the spot price relative to the
price threshold at which the liquidity changes. When liquidity is more favorable, the strategy tends to frontload execution to reduce exposure to the risk of falling into the low-liquidity region following an adverse
price movement, where execution costs are higher. Conversely, when the liquidity level is less favorable,
the strategy postpones execution, waiting for a favorable price movement to benefit from lower costs in
the higher-liquidity zone. We believe that this work may help practitioners in the DeFi ecosystem better
understand execution mechanisms and reduce associated costs.


Finally, we assume that the liquidity of the pool is constant throughout the trading horizon, i.e., LPs remain
passive. In the spirit of Cartea et al. (2025), a natural extension would be to incorporate stochastic liquidity
dynamics.

### **Acknowledgments**


The authors would like to thank Mohamed Frihat, Vincent Danos, Hamza El Khalloufi and Alejandro Roig´e
V´azquez for fruitful discussions.


This work used HPC resources from the “M´esocentre” computing center of CentraleSup´elec and Ecole Nor- [´]
male Sup´erieure Paris-Saclay supported by CNRS and R´egion [ˆ] Ile-de-France.

### **Disclosure of interest**


The authors have no competing interests to declare.

### **References**


Adams, H., Zinsmeister, N., and Robinson, D. (2020). Uniswap v2 core. Available at `[https://app.uniswap.](https://app.uniswap.org/whitepaper.pdf)`
`[org/whitepaper.pdf](https://app.uniswap.org/whitepaper.pdf)` .


Adams, H., Zinsmeister, N., Salem, M., Keefer, R., and Robinson, D. (2021). Uniswap v3 core. Available at
`[https://app.uniswap.org/whitepaper-v3.pdf](https://app.uniswap.org/whitepaper-v3.pdf)` .


Alfonsi, A., Fruth, A., and Schied, A. (2008). Constrained portfolio liquidation in a limit order book model.
_Banach Center Publications_, 83:9–25.


Alfonsi, A., Fruth, A., and Schied, A. (2010). Optimal execution strategies in limit order books with general
shape functions. _Quantitative Finance_, 10(2):143–157.


Almgren, R. and Chriss, N. (1999). Value under liquidation. _Risk_, 12(12):61–63.


Almgren, R. and Chriss, N. (2001). Optimal execution of portfolio transactions. _Journal of Risk_, 3:5–40.


22


Almgren, R. F. (2003). Optimal execution with nonlinear impact functions and trading-enhanced risk.
_Applied Mathematical Finance_, 10(1):1–18.


Bochud, T. and Challet, D. (2007). Optimal approximations of power laws with exponentials: Application
to volatility models with long memory. _Quantitative Finance_, 7(6):585–589.


Bouchaud, J.-P., Bonart, J., Donier, J., and Gould, M. (2018). _Trades, quotes and prices: Financial markets_
_under the microscope_ . Cambridge University Press.


Busseti, E. and Lillo, F. (2012). Calibration of optimal execution of financial transactions in the presence of
transient market impact. _Journal of Statistical Mechanics: Theory and Experiment_, 2012(09):P09010.


Cartea, A., Drissi, F., and Monga, M. (2025). Decentralised finance and automated market making: Execu- [´]
tion and speculation. _Journal of Economic Dynamics and Control_, 177:105134.


Cartea, A., Jaimungal, S., and Penalva, J. (2015). [´] _Algorithmic and high-frequency trading_ . Cambridge
University Press.


Curato, G., Gatheral, J., and Lillo, F. (2017). Optimal execution with non-linear transient market impact.
_Quantitative Finance_, 17(1):41–54.


Egorov, M. (2019). StableSwap - efficient mechanism for stablecoin liquidity. Available at `[https://classic.](https://classic.curve.finance/files/stableswap-paper.pdf)`
`[curve.finance/files/stableswap-paper.pdf](https://classic.curve.finance/files/stableswap-paper.pdf)` .


Gatheral, J., Schied, A., and Slynko, A. (2012). Transient linear price impact and Fredholm integral
equations. _Mathematical Finance: An International Journal of Mathematics, Statistics and Financial_
_Economics_, 22(3):445–474.


Gu´eant, O. (2016). _The financial mathematics of market liquidity: From optimal execution to market making_,
volume 33. CRC Press.


Kirk, D. E. (2004). _Optimal control theory: An introduction_ . Courier Corporation.


Martinelli, F. and Mushegian, N. (2019). A non-custodial portfolio manager, liquidity provider, and price
sensor. Available at `[https://docs.balancer.fi/whitepaper.pdf](https://docs.balancer.fi/whitepaper.pdf)` .


Obizhaeva, A. A. and Wang, J. (2013). Optimal trading strategy and supply/demand dynamics. _Journal of_
_Financial markets_, 16(1):1–32.


Tran, T., Tran, D. A., and Nguyen, T. (2024). Order book inspired automated market making. _IEEE Access_,
12:36743–36763.

### **Appendix**


**A** **Proofs**


**A.1** **Proof of Proposition 1 and Corollary 1**

_Proof._ By introducing a Lagrange multiplier _λ ∈_ R for the equality [�] _m_ _[N]_ =0 _[δ][m]_ [ =] _[ ξ]_ [ in (12), we obtain:]



_N_
_δ_ _[∗]_ = argmax E�                - _Cn_                - + _λ_                - _ξ −_
_δ_

_n_ =0


For _m_ = 0 _, . . ., N_, the first-order condition from (52) reads:



_N_

- _δn_ - _._ (52)


_n_ =0



_N_
_∂_ - - E _Cn_ = _λ,_ (53)
_∂δm_

_n_ =0


23


where,
_N_
_∂_         -         E
_∂δm_




- ~~�~~

_ωje_ _[−][ρ][j]_ [(] _[m][−][n]_ [)∆] E[ _fm_

_j_ =0




  _fn_ ]




- 
_Cn_ = E[ _fm_ ] _−_ [2]

_L_

_n_ =0



_m_




(54)



_L_



_m_ _J_

- _δn_ _[∗]_ - 
_n_ =0 _j_ =0




- ~~�~~

_ωje_ _[−][ρ][j]_ [(] _[n][−][m]_ [)∆] E[ _fn_

_j_ =0




  _fm_ ] _._




_−_ [2]

_L_



_N_ _J_

- _δn_ _[∗]_ - 
_n_ = _m_ +1 _j_ =0



_N_




We can rewrite the _N_ + 1 first-order conditions (53) in compact matrix form as:


_Aδ_ _[∗]_ = _[L]_                 - _B −_ _λ_ 1                 - _,_ (55)

2

where 1 = �1 _, . . .,_ 1� _⊤_ . The vector _B ∈_ R _N_ +1 and the matrix _A ∈_ R( _N_ +1) _×_ ( _N_ +1), defined in (14) and (15)
respectively, are derived from (54). Substituting (55) in the volume constraint (9) implies:

_λ_ _[∗]_ = [1] _[⊤][A][−]_ [1] _[B][ −]_ [2] _L_ _[ξ]_ _,_ (56)

1 _[⊤]_ _A_ _[−]_ [1] 1

and plugging _λ_ _[∗]_ in (55) yields the closed-form optimal execution schedule:


_δ_ _[∗]_ = _[L]_ (57)

2 [(] _[A][−]_ [1] _[B][ −]_ _[λ][∗][A][−]_ [1] [1] [)] _[.]_


When the fundamental price process is a martingale, the expected price at each time step remains constant
and equal to the initial price. The vector _B_ reduces to:


_B_ = _f_ 0 1 _._ (58)


Plugging (58) into the general solution (57), the optimal execution schedule simplifies to (16).


**A.2** **Proof of Corollary 2**


_Proof._ Under the geometric Brownian motion assumption (17), the expectations appearing in (14) and (15)
admit closed-form expressions. For _m_ = 0 _, . . ., N_, the expected fundamental price reads E[ _fm_ ] = _f_ 0 _e_ _[µm]_ [∆] .
Moreover, for _n ≤_ _m_, we have:




~~�~~
E[ _fm_



_fn_ ] = _f_ 0 ~~�~~



_f_ 0 _e_ _[µ]_ [(] _[m]_ [+] _[n]_ 2




_[n]_ 2 [)∆+] [3] _[σ]_ 8 [2]



8 _[n]_ [∆] _,_ (59)



and for _n > m_ :

         E[ _fn_



_f_ 0 _e_ _[µ]_ [(] _[n]_ [+] _[m]_ 2



_fm_ ] = _f_ 0 ~~�~~



2 [)∆+] [3] _[σ]_ 8 [2]



8 _[m]_ [∆] _._ (60)



We start with a single resilience factor (i.e., _J_ = 0), for which the matrix _A_ from (15) takes the following
_√_
form, up to the multiplicative factor _f_ 0 _f_ 0, which is omitted for notational clarity:













_A_ =







_b_ 0 _ab_ 0 _a_ [2] _b_ 0 _a_ [3] _b_ 0 _· · ·_ _a_ _[N]_ _b_ 0
_ab_ 0 _b_ 1 _ab_ 1 _a_ [2] _b_ 1 _· · ·_ _a_ _[N]_ _[−]_ [1] _b_ 1
_a_ [2] _b_ 0 _ab_ 1 _b_ 2 _ab_ 2 _· · ·_ _a_ _[N]_ _[−]_ [2] _b_ 2
_a_ [3] _b_ 0 _a_ [2] _b_ 1 _ab_ 2 _b_ 3 _· · ·_ _a_ _[N]_ _[−]_ [3] _b_ 3
... ... ... ... ... ...
_a_ _[N]_ _b_ 0 _a_ _[N]_ _[−]_ [1] _b_ 1 _a_ _[N]_ _[−]_ [2] _b_ 2 _a_ _[N]_ _[−]_ [3] _b_ 3 _· · ·_ _bN_



_._ (61)




               - 3 _µ_
where _a_ = _e_ _[−]_ [(] _[ρ][−][µ]_ [)∆] and _bn_ = _e_ 2



where _a_ = _e_ _[−]_ [(] _[ρ][−][µ]_ [)∆] and _bn_ = _e_ - 32 _µ_ [+] [3] _[σ]_ 8 [2] - _n_ ∆. Let _e_ 0 _, . . ., eN_ denote the canonical basis of R _N_ +1 and, in the

spirit of Alfonsi et al. (2008), we define the vectors _v_ 0 _, . . ., vN_ by the recursive formula:

            - _v_ 0 = _e_ 0
(62)
_vn_ = _vn−_ 1 _a_ + _en_ _[√]_ ~~_γ_~~ _n_ ~~_,_~~



2 _µ_ [+] [3] _[σ]_ 8 [2]



24


where _γn_ = _bn_ _−a_ [2] _bn−_ 1 for _n_ = 1 _, . . ., N_, with _γ_ 0 = 1, and subject to the condition on the drift: _µ <_ [3] _[σ]_ 4 [2] [+4] _[ρ]_

to ensure _γn >_ 0 for _n_ = 1 _, . . ., N_ . This condition is automatically satisfied in the martingale case (i.e.,
when _µ_ = 0). The matrix _A_ is the corresponding Gram matrix: _⟨vm, vn⟩_ = _a_ _[|][m][−][n][|]_ _b_ min( _m,n_ ) = _Amn_ for
_m_ = 0 _, . . ., N_ and _n_ = 0 _, . . ., N_ . Indeed, first by induction: _⟨vn, vn⟩_ = _bn_ . Second, for _n < m_ we have:
_⟨vm, vn⟩_ = _a_ _[m][−][n]_ _⟨vn, vn⟩_ and for _m < n_ : _⟨vm, vn⟩_ = _a_ _[n][−][m]_ _⟨vm, vm⟩_ . Thus, the matrix _A_ is positive definite.
Therefore, the objective function is strictly concave as the associated Hessian matrix is given by _−_ _L_ [2] _[A]_ [.]

In addition, the volume constraint [�] _n_ _[N]_ =0 _[δ][n]_ [ =] _[ ξ]_ [ defines a convex feasible set. Together, these properties]
guarantee that the optimal strategy _δ_ _[∗]_ in (13) is the unique maximizer of the execution problem (12).



From the recursive formula (62), we also have:


_vn_ =



_n_



_k_ =0




- _a_ _[n][−][k][√]_ ~~_γ_~~ _k_ - _ek._ (63)



Let _V_ be the upper triangular matrix whose columns are the vectors _v_ 0 _, . . ., vN_ :



1 _a_ _a_ [2] _· · ·_ _a_ _[N]_










_._ (64)




_V_ =







_√_
0 ~~_γ_~~ 1 _a√_ _[√]_ ~~_γ_~~ 1 _· · ·_ _a_ _[N]_ _[−]_ [1] _[√]_ ~~_γ_~~ 1
0 0 ~~_γ_~~ 2 _· · ·_ _a_ _[N]_ _[−]_ [2] _[√]_ ~~_γ_~~ 2
... ... ... ... ...
_√_
0 0 0 _· · ·_ ~~_γ_~~ _N_



Then, _A_ = _V_ _[⊤]_ _V_ . Indeed, for any _m_ = 0 _, . . ., N_ and _n_ = 0 _, . . ., N_ :



min( _m,n_ )

 - _VkmVkn,_ (65)


_k_ =0



( _V_ _[⊤]_ _V_ ) _mn_ =



_N_

- _VkmVkn_ =


_k_ =0



since _V_ is upper triangular. Substituting the expression for _Vkm_ and _Vkn_ :



min( _m,n_ )

- _a_ _[m][−][k][√]_ ~~_γ_~~ _k_ - - _a_ _[n][−][k][√]_ ~~_γ_~~ _k_ - = _a_ _[m]_ [+] _[n]_ - _a_ _[−]_ [2] _[k]_ [�] _bk −_ _a_ [2] _bk−_ 1� _,_ (66)


_k_ =0



( _V_ _[⊤]_ _V_ ) _mn_ =



min( _m,n_ )

 

_k_ =0



where _b−_ 1 = 0. This sum telescopes to _a_ _[−]_ [2 min(] _[m,n]_ [)] _b_ min( _m,n_ ), yielding ( _V_ _[⊤]_ _V_ ) _mn_ = _a_ _[|][m][−][n][|]_ _b_ min( _m,n_ ) = _Amn_ .
The diagonals coefficients of the upper triangular matrix _V_ are all strictly positives. Then, _V_ is invertible
and _A_ _[−]_ [1] = _V_ _[−]_ [1] ( _V_ _[−]_ [1] ) _[⊤]_ . Finally, the inverse matrix _A_ _[−]_ [1] is tridiagonal and is given by (18).


In the general multi-kernel case, let _e_ 0 _, . . ., eN_ denote the canonical basis of R _[N]_ [+1], and let _f_ 0 _, . . ., fJ_ denote
the canonical basis of R _[J]_ [+1] . For _j_ = 0 _, . . ., J_, we define the vectors _v_ 0 _[j][, . . ., v]_ _N_ _[j]_ [by the recursive formula:]

          - _v_ 0 _[j]_ [=] _[ e]_ [0]

            - (67)
_vn_ _[j]_ [=] _[ v]_ _n_ _[j]_ _−_ 1 _[a][j]_ [ +] _[ e][n]_ _bn −_ _a_ [2] _j_ _[b][n][−]_ [1] _[,]_




              - 3 _µ_
where _aj_ = _e_ _[−]_ [(] _[ρ][j]_ _[−][µ]_ [)∆], _bn_ = _e_ 2




_[σ]_ [2] 
8 _n_ ∆ and subject to the condition on the drift: _µ <_ 3 _σ_ [2]



2 _µ_ [+] [3] _[σ]_ 8 [2]



where _aj_ = _e_ _[j]_, _bn_ = _e_ 2 8 and subject to the condition on the drift: _µ <_ 4 [+ 4 min] _[j][ ρ][j]_ [, to]

ensure _bn −_ _a_ [2] _j_ _[b][n][−]_ [1] _[ >]_ [ 0 for] _[ n]_ [ = 1] _[, . . ., N]_ [ and] _[ j]_ [ = 0] _[, . . ., J]_ [. Then, we define:]



_vn_ =



_J_



_j_ =0



_√_ ~~_ω_~~ _j_ ~~(~~ _fj ⊗_ _vnj_ [)] _[.]_ (68)



The matrix _A_ is the corresponding Gram matrix:



_J_

- _ωja_ _[|]_ _j_ _[m][−][n][|]_ _b_ min( _m,n_ ) = _Amn._ (69)

_j_ =0


25



_⟨vm, vn⟩_ =



_J_

- _ωj⟨vm_ _[j]_ _[, v]_ _n_ _[j]_ _[⟩]_ [=]


_j_ =0


Following the same arguments as in the single resilience factor case, the objective function is strictly concave
and the optimal strategy _δ_ _[∗]_ in (13) is the unique maximizer of the execution problem (12). However,
the methodology used to derive the inverse of _A_ in the single-kernel case does not extend to the general
multi-kernel setting.


**A.3** **Proof of Proposition 2**


_Proof._ We consider the _ansatz_ (23) with coefficients _An,_ ( _Bn_ _[j]_ [)] _[J]_ _j_ =0 _[, C][n][, D][n][,]_ [ (] _[E][n]_ [)] _j_ _[J]_ =0 [and (] _[F][n]_ [)] _j_ _[J]_ 1 _,j_ 2=0 [determined]
by backward recursion. Substituting (23) into the Bellman equation (21) yields a quadratic objective in _δn_ :



2 _[µ]_ [+] [3] _[σ]_ 8 [2]



8 [)∆]




  - 1
_fn_



_L_



_J_




_vn_ ( _xn,_ ( _In_ _[j]_ [)] _[J]_ _j_ =0 _[, f][n]_ [) = sup] _−_ _δn_ [2] _[f][n]_ _δn_



1 [2]

_L_ [+] _L_




- _Bn_ _[j]_ +1 _[e]_ [(] _[µ][−][ρ][j]_ [)∆] _[−]_ _[C][n]_ [+1] _[e]_ [(] [3] 2 _[µ]_

_j_ =0




_[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2]




_−_ [4]

_L_ [2]



_J_



_j_ 1=0




- _Fn_ _[j]_ [1] +1 _[,j]_ [2] _[e]_ [(] _[µ]_ 2

_j_ 2=0



_J_





[2]

8 [)∆][�]




_[µ]_ 2 _[−][ρ][j]_ _[−]_ _[σ]_ 8 [2]



8 [)∆][�]



+ _δn_ - _fn_ �1 _−_ _An_ +1 _e_ _[µ]_ [∆] + [2]

_L_



_J_





- _En_ _[j]_ +1 _[e]_ [(] _[µ]_ 2

_j_ =0




_[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2]



8 [)∆][�]




- _In_ _[j]_ [1] - _−_ _ωj_ 1 _−_ _Bn_ _[j]_ [1] +1 _[e]_ [(] _[µ][−][ρ][j]_ [1] [)∆] [+] [4]

_L_

_j_ 1=0



_J_




(70)



+ _fn_



_J_




_L_




- _Fn_ _[j]_ [1] +1 _[,j]_ [2] _[e]_ [(] _[µ]_ 2

_j_ 2=0



2 _[µ]_ [+] [3] _[σ]_ 8 [2]



_fn_ ~~�~~ 2

_L_



_fn_ ~~�~~ 2



_J_





- _Bn_ _[j]_ +1 _[e]_ [(] _[µ][−][ρ][j]_ [)∆] _[−]_ [2] _[C][n]_ [+1] _[e]_ [(] [3] 2 _[µ]_

_j_ =0




_[σ]_ [2]

8 [)∆][��]



+ _xnfn_ 


_J_




2 _[µ]_ [+] [3] _[σ]_ 8 [2]




_[σ]_ 8 [)∆] _xn_ 



    + _xnfn_ _An_ +1 _e_ _[µ]_ [∆] +




- _Bn_ _[j]_ +1 _[e]_ [(] _[µ][−][ρ][j]_ [)∆] _[I]_ _n_ _[j]_ [+] _[ C][n]_ [+1] _[e]_ [(] [3] 2 _[µ]_

_j_ =0




 _fn_




_[µ]_ 2 _[−][ρ][j]_ _[−]_ _[σ]_ 8 [2]



8 [)∆] _In_ _[j]_



_fn_ - _Dn_ +1 _e_ [(] _[µ]_ 2



+ 



_[µ]_ 2 _[−]_ _[σ]_ 8 [2]



8 [)∆] +



_J_





- _En_ _[j]_ +1 _[e]_ [(] _[µ]_ 2

_j_ =0



_J_





- _Fn_ _[j]_ [1] +1 _[,j]_ [2] _[e]_ [(] _[µ]_ 2

_j_ 2=0




_[µ]_ 2 _[−][ρ][j]_ 1 _[−][ρ][j]_ 2 _[−]_ _[σ]_ 8 [2]




[2]  
8 [)∆] _In_ _[j]_ [1] _[I]_ _n_ _[j]_ [2] _,_



+



_J_



_j_ 1=0



and leads to the explicit control (24). The substitution of the optimal control into the Bellman equation (21)
and the terminal condition (22), and identification of coefficients in the polynomial basis yields the backward
recursions (27).


**B** **Optimal execution on Uniswap v2: the two-period martingale case**


In the case _µ_ = 0, _N_ = 1 and _J_ = 0, the matrix _A_ defined in (15) reads:







_A_ = _f_ 0� _f_ 0




- 1 _e_ _[−][ρ]_ [∆]

3 _σ_ [2]
_e_ _[−][ρ]_ [∆] _e_ 8 [∆]



_._ (71)



The corresponding optimal trades are:



3 _σ_ [2]
_e_ 8
_δ_ 0 _[∗]_ [=] _[ ξ]_ 3 _σ_ [2]



3 _σ_ [2]
_e_ 8



_e_ 8 [∆] _−_ _e_ _[−][ρ]_ [∆] 1 _−_ _e_ _[−][ρ]_ [∆]

_σ_ [2] 1 [=] _[ ξ]_ 3 _σ_ [2]

8 [∆] + 1 _−_ 2 _e_ _[−][ρ]_ [∆] _[, δ][∗]_ _e_ 8 [∆] + 1 _−_ 2



8 [∆] _−_ _e_ _[−][ρ]_ [∆]



_σ_ [2] (72)

8 [∆] + 1 _−_ 2 _e_ _[−][ρ]_ [∆] _[.]_



3 _σ_ [2]
_e_ 8



A direct comparison yields _δ_ 0 _[∗]_ _[> δ]_ 1 _[∗]_ [which establishes that the first trade is larger than the last one in the]
two-period framework, consistently with the numerical observations reported in Section 2.3.1.


26


Differentiating with respect to volatility _σ_ gives:



_∂δ_ 0 _[∗]_

[3] _[σ]_
_∂σ_ [=] _[ ξ]_ 4



_σ_ [2] 1 _−_ _e_ _[−][ρ]_ [∆]

8 [∆]

~~�~~ _e_ 3 _σ_ 8 [2] [∆] + 1 _−_ 2




_[σ]_ 3 _σ_ [2]

8

4 [∆] _[e]_



_σ_ [2] _[>]_ [ 0] _[,]_ (73)

8 [∆] + 1 _−_ 2 _e_ _[−][ρ]_ [∆] ~~[�]~~ [2]



showing that higher volatility increases the size of the initial trade. Differentiation with respect to the
resilience parameter _ρ_ gives:



3 _σ_ [2]
_∂δ_ 0 _[∗]_ 1 _−_ _e_ 8
_∂ρ_ [=] _[ ξ]_ [∆] _[e][−][ρ]_ [∆] ~~�~~ 3 _σ_ 8 [2] [∆]



1 _−_ _e_ 8 [∆]

~~�~~ _e_ 3 _σ_ 8 [2] [∆] + 1 _−_ 2 _e_



_σ_ [2] _[<]_ [ 0] _[,]_ (74)

8 [∆] + 1 _−_ 2 _e_ _[−][ρ]_ [∆] ~~[�]~~ [2]



which indicates that faster price recovery of the liquidity pool reduces the size of the initial trade.


Finally, we study the asymptotic behavior of the optimal trades. When volatility becomes large, the solution
converges to a fully front-loaded strategy:


_σ→_ lim+ _∞_ _[δ]_ 0 _[∗]_ [=] _[ ξ,]_ _σ→_ lim+ _∞_ _[δ]_ 1 _[∗]_ [= 0] _[.]_ (75)


When the resilience parameter becomes large, we obtain:



3 _σ_ [2]
_e_ 8
_ρ→_ lim+ _∞_ _[δ]_ 0 _[∗]_ [=] _[ ξ]_ 3 _σ_ [2] [∆]



3 _σ_ [2]
_e_ 8



8 [∆]



_σ_ [2] _._ (76)

8 [∆] + 1



8 1

_σ_ 8 [2] [∆] + 1 _,_ _ρ→_ lim+ _∞_ _[δ]_ 1 _[∗]_ [=] _[ ξ]_ _e_ 3 _σ_ 8 [2] [∆]



3 _σ_ [2]
_e_ 8



In this regime, the price recovers instantaneously, and the trade allocation reflects only the effects of volatility,
with a persistent asymmetry favoring earlier execution under higher expected price impact.


**C** **Backward algorithm**


Under the two-layer liquidity framework introduced in Section 3.1, the backward algorithm is provided in
the form of pseudocode in Algorithm 1.


**D** **Consistency and stability checks**


First, we present consistency checks conducted within the Uniswap v2 framework. We compare the numerical
results obtained using the algorithm introduced in Section 3.2, when the liquidity layers coincide (i.e.,
_L_ 0 = _L_ 1) with the closed-form solution derived in Section 2.2.3, both evaluated along the mean price
trajectory. Specifically, we fix _Kx_ = 250 and compute the maximum and mean absolute errors for different
values of the grid sizes _Kf_ and _KI_ . Results are reported in Figures 10a, 10b and demonstrate that the
discretization scheme provides accurate estimates of the optimal strategy in the Uniswap v2 framework.
These results also indicate that the accuracy of the numerical solution is more sensitive to the price grid size
than to that of the cumulative market impact. Indeed, once _KI_ exceeds 30, both mean and maximum errors
remain nearly unchanged for fixed values of _Kf_ .


Second, we assess the stability of the numerical scheme within the two-layer liquidity framework introduced
in Section 3.1 by varying the grid resolution. We fix the threshold level at ~~_s_~~ = _−_ 25bps and set _Kx_ = 250.
We compute the maximum and mean absolute deviations relative to a reference solution obtained with the
high-resolution configuration ( _Kf_ = 500, _Kx_ = 250, and _KI_ = 500), presented in Section 3.3. The results,
reported in Figures 11a, 11b, show that the deviation consistently decreases as the grid resolution increases.
Moreover, as in the Uniswap v2 setting, accuracy is more sensitive to the resolution of the price grid than
to that of the cumulative impact grid. Finally, the computational cost of the high-resolution configuration
is significant, requiring approximately 45 minutes. However, with a coarser grid of _Kf_ = 250, _Kx_ = 250,
and _KI_ = 50, the computation time drops to 2 minutes, with a maximum deviation of 0 _._ 0105 and a mean
deviation of 0 _._ 0045.


27


**Algorithm 1** Two-layer liquidity backward algorithm


**Input:**

`-` The strategy parameters: _T, N_ and _ξ_

`-` The market parameters: _f_ 0 _,_ ~~_p,_~~ _L_ 0 and _L_ 1

`-` The model parameters: _J,_ ( _ρj_ ) _[J]_ _j_ =0 _[,]_ [ (] _[ω][j]_ [)] _[J]_ _j_ =0 _[, µ]_ [ and] _[ σ]_

`-` The grid parameters: _Kx, KI_ _, Kf_ and _z_
**Output:**

`-` The estimated optimal execution strategy _δ_ _[∗]_

`-` The associated value function _v_


Set the grids according to (45), (46), (47) and (48)
Set _vN_ according to (43) _▷_ The terminal value function is initialized.


**for** _n_ = _N −_ 1 _, . . .,_ 0 **do** _▷_ Backward iteration.
**for** _kf_ = 0 _, . . ., Kf_, _kx_ = 0 _, . . ., Kx_, _ki_ _[j]_ [= 0] _[, . . ., K][I]_ [,] _[ j]_ [ = 0] _[, . . ., J]_ **[ do]**
**for** _k_ = 0 _, . . ., kx_ **do**

Set _δn_ = _x_ [(] _[k]_ [)] _▷_ Candidate trade from the inventory grid.

Compute the resulting cash-flow _Cn_ ( _x_ [(] _[k][x]_ [)] _,_ ( _I_ [(] _[k]_ _i_ _[j]_ [)] ) _[J]_ _j_ =0 _[, f]_ [ (] _[k][f]_ [ )] _[, δ][n]_ [) from (44)]

Update the cumulative price impacts _In_ _[j]_ +1 [(] _[x]_ [(] _[k][x]_ [)] _[,]_ [ (] _[I]_ [(] _[k]_ _i_ _[j]_ [)] ) _[J]_ _j_ =0 _[, f]_ [ (] _[k][f]_ [ )] _[, δ][n]_ [) from (41)]


Update the remaining inventory _xn_ +1 = _x_ [(] _[k][x]_ [)] _−_ _δn_

Perform a ( _J_ +1)-d linear interpolation to derive _vn_ +1( _x_ [(] _[k][x]_ [)] _,_ ( _I_ [(] _[k]_ _i_ _[j]_ [)] ) _[J]_ _j_ =0 _[, f]_ [ (] _[k][f]_ [ )][) for] _[ k][f]_ [ = 0] _[, . . ., K][f]_


Estimate the conditional expectation ~~_v_~~ _n_ +1 using (49)


Store the total value _Cn_ + ~~_v_~~ _n_ +1 for each candidate trade _δn_


**end for**


Determine the optimal trade:


_δn_ _[∗]_ [(] _[x]_ [(] _[k][x]_ [)] _[,]_ [ (] _[I]_ [(] _[k]_ _i_ _[j]_ [)] ) _[J]_ _j_ =0 _[, f]_ [ (] _[k][f]_ [ )][) = argmax] _Cn_ + ~~_v_~~ _n_ +1
_δn_


Update the value function _vn_ ( _x_ [(] _[k][x]_ [)] _,_ ( _I_ [(] _[k]_ _i_ _[j]_ [)] ) _[J]_ _j_ =0 _[, f]_ [ (] _[k][f]_ [ )][) accordingly]


**end for**
**end for**


28


(a) Mean absolute error


(b) Maximum absolute error





Figure 10: Mean and maximum absolute error with respect to _KI_ and _Kf_ for _Kx_ = 250 in the Uniswap v2
framework; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ = 1000, _f_ 0 = 1, _µ_ = 0, _σ_ = 0 _._ 3, _J_ = 0 and _ρ_ = 3.


29


(a) Mean absolute deviation


(b) Maximum absolute deviation





Figure 11: Mean and maximum absolute deviation with respect to _KI_ and _Kf_ for _Kx_ = 250 in the two-layer
liquidity framework; _T_ = 1, _N_ = 10, _ξ_ = 1, _L_ 0 = 1000, _L_ 1 = 500, _f_ 0 = 1, ~~_s_~~ = _−_ 25bps, _µ_ = 0, _σ_ = 0 _._ 3, _J_ = 0
and _ρ_ = 3.


30


