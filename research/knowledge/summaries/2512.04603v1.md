## FX Market Making with Internal Liquidity

Alexander Barzykin [1], Robert Boyce [1, 2], and Eyal Neuman [2]


1HSBC
2Department of Mathematics, Imperial College London


December 5, 2025


**Abstract**


As the FX markets continue to evolve, many institutions have started offering passive access to
their internal liquidity pools. Market makers act as principal and have the opportunity to fill
those orders as part of their risk management, or they may choose to adjust pricing to their
external OTC franchise to facilitate the matching flow. It is, a priori, unclear how the strategies
managing internal liquidity should depend on market condions, the market maker’s risk appetite,
and the placement algorithms deployed by participating clients. The market maker’s actions
in the presence of passive orders are relevant not only for their own objectives, but also for
those liquidity providers who have certain expectations of the execution speed. In this work,
we investigate the optimal multi-objective strategy of a market maker with an option to take
liquidity on an internal exchange, and draw important qualitative insights for real-world trading.

### **1 Introduction**


Internalisation has long been a key component of efficient algorithmic execution in foreign exchange
(FX) markets, primarily due to its reduced visibility and consequently minimal market impact.
Traditional internalisation typically involves client-to-client matching, where a liquidity provider
acts as a neutral intermediary. This mechanism, classified as Internalisation Type A by the Foreign
Exchange Professionals Association (FXPA) [FXPA guidance], offers certain advantages but also
inherent limitations, as matching opportunities tend to be scarce.


Since FX trading remains largely over-the-counter (OTC), interaction with OTC liquidity is
expected to be the primary driver of internalisation. The FXPA defines Internalisation Type B as
the offsetting of commercial flow by a liquidity provider. This naturally involves client algorithms
trading against a market maker’s pricing stream, benefitting from ultra-low latency and potentially
tighter spreads due to inventory skew.


Recently, several institutions have begun offering passive access to internal liquidity, either
through conventional limit or pegged orders. Dynamic orders are typically pegged to an internally
maintained fair reference price, allowing client algorithms to communicate in the “high-frequency
language” of the market maker, without requiring high-frequency order management. Market makers
may fill these orders to meet their risk management objectives; importantly, they can also adjust
pricing in their OTC franchise to facilitate such fills. In this way, client algorithms can interact
with deep OTC liquidity through the internalisation mechanism.


One might tacitly assume that market makers directly transfer pegged order quantities onto
their pricing ladder at the same price and then immediately fill them upon receiving an opposing


1


trade. However, such a naïve approach would clearly be detrimental to the market maker’s risk
management and would reduce potential P&L. In practice, market makers must instead solve an
optimal market-making problem in the presence of an additional liquidity source, be it a single limit
order or, more generally, a limit order book on an internal exchange.


Understanding the underlying mathematical formulation of this problem can improve the transparency of internalisation, in line with recent FXPA guidance. Orders on the internal exchange
cannot be taken for granted: they may be cancelled, be of finite but unknown size, or follow an unpredictable strategy and thus may not always be available. Moreover, the market-making desk may
prefer to fill client orders on the internal exchange, as doing so supports the firm’s client algo desk,
which manages those orders, and ultimately provides better service to clients. The market-making
desk therefore faces a complex and multifaceted trade-off.


The mathematical finance literature on market making originates from the model of Avellaneda
and Stoikov [12], later solved in closed form by Guéant et al. [8]. Subsequent extensions include
the linear–quadratic framework of Cartea et al [13], influential order effects in Cartea et al. [1],
continuous hedging in Barzykin et al. [5], and competition among market makers in Boyce et al.

[11]. Interactions between market makers and clients have also been explored, notably through
the game-theoretic approach of Cartea and Sánchez-Betancourt [4], while internalisation has been
examined in various contexts, including the FX market in Butz and Oomen [6]. Since Avellaneda
and Stoikov [12], financial markets and the role of market makers have evolved substantially. A key
recent innovation is the emergence of internal exchanges, enabling clients to provide liquidity directly
to market makers. This remains largely unexplored, with the exception of Morimoto [3], who study
optimal execution under unlimited internal liquidity with price impact. Relatedly, passive impact
has attracted renewed attention, most notably in Chahdi et al. [9].


In this work, we present the first quantitative investigation of internal exchange management
from the market maker’s perspective. We develop a model in which the market maker continuously
streams a price ladder of multiple sizes to external, liquidity-taking clients while optimally timing
trades with liquidity-providing clients on an internal exchange. The market maker aims to maximise P&L while remaining averse to large inventory positions and unfilled internal orders. Internal
exchange orders are transient, that is they may be cancelled, executed, or reappear later, capturing
realistic client execution patterns such as iceberg, TWAP, or full-amount strategies. From a mathematical perspective, our formulation of the market maker’s problem leads to a stochastic control
problem over external prices, consistent with classical market-making frameworks [12, 7], combined
with repeated optimal stopping decisions for the timing of internal trades, as in the optimal execution framework of [2, 3]. The resulting Hamilton–Jacobi–Bellman quasi-variational inequality
(HJBQVI) is then solved numerically.


We derive practical insights with direct relevance to real-world trading. In particular, we demonstrate that there exists an execution threshold, i.e. the inventory level beyond which the market
maker will instantaneously fill the limit order. Otherwise, the market maker will adjust pricing to
external OTC clients accelerating the move towards the execution threshold, thus facilitating the fill
of the limit order. The degree of price skew and the execution threshold level depend on the market
maker’s risk aversion, limit order depth and expected placement strategy, as well as on flow facilitation initiatives. Importantly, the optimal strategy significantly outperforms a naïve benchmark
strategy that directly incorporates internal exchange orders into the OTC pricing ladder.


2


### **2 The model**

Let _T >_ 0 denote the trading period. We fix a filtered probability space (Ω _, F,_ F = _{Ft}t∈_ [0 _,T_ ] _,_ P)
satisfying the usual hypothesis. Let ( _St_ ) _t≥_ 0 be the price process of a risky asset such that _St_ =
_S_ 0 + _σWt_, where _W_ is a standard Brownian motion and _S_ 0 _, σ_ are positive constants. We consider
a market maker who continuously provides liquidity on both sides of the order book, quoting bid
and ask prices ( _S_ _[b,z]_ _, S_ _[a,z]_ ) that are streamed and adjusted according to the clients’ order sizes
_Z_ = _{zk,_ 1 _≤_ _k ≤_ _K}_ :


_St_ _[b,z]_ = _St −_ _δt_ _[b,z]_ and _St_ _[a,z]_ = _St_ + _δt_ _[a,z]_ _,_ 0 _≤_ _t ≤_ _T,_ _z ∈Z._


Note that the half-spreads ( _δ_ _[b,z]_ _, δ_ _[a,z]_ ) are controlled by the market maker and chosen from the set
of admissible half-spreads


       - �� _T_        -        _D_ = _δ_ : _δ_ progressively measurable s.t. E _δt_ [2] _[dt]_ _< ∞_ _._ (2.1)

0


Market buy and sell orders of OTC clients are modelled by independent counting processes _N_ _[a,z]_ =
( _Nt_ _[a,z]_ ) _t≥_ 0 and _N_ _[b,z]_ = ( _Nt_ _[b,z]_ ) _t≥_ 0 for any order size _z ∈Z_, with intensities


                  -                  Λ _[b/a,z]_ ( _δt_ _[b/a,z]_ ) = _λ_ _[b/a,z]_ exp _−_ _κ_ _[z]_ _δt_ _[b/a,z]_ 0 _≤_ _t ≤_ _T._ (2.2)


Here _λ_ _[b/a,z]_ and _κ_ _[z]_ are positive constants.


We assume that, in the internal exchange, the client has placed a limit order on one side of the
book. Without loss of generality, we take this to be an ask limit order with an initial size of _ℓ_ ; that
is, the client intends to sell, and the dealer would buy if a trade occurs.

The order size at any time _t_, denoted by _{Lt}_ 0 _,T_ which is a càdlàg process that determines the
liquidity in the internal exchange and it is given by,




    - _t_
_Lt_ = _ℓ_ _−_ _ℓ_



_t_  - _t_

1 _{Ls>_ 0 _}dCs_ + _ℓ_
0 0



1 _{Ls≤_ 0 _}dAs_ + _ℓRt −_ _Mt,_ 0 _≤_ _t ≤_ _T,_ (2.3)
0



Note that _ℓ>_ 0 corresponds to an order being present at time _t_ = 0, whereas _ℓ_ _≤_ 0 indicates the
absence of an order. Moreover, larger magnitudes of _ℓ_ decrease the likelihood of the order appearing,
since liquidity can be consumed by the market maker only when _Lt >_ 0 in (2.3). The processes
( _A, C, M, R_ ) are defined and characterized below.


  - ( _Ct_ ) _t≥_ 0 represents the cancellation of the order by the client and is modelled as an independent
Poisson process with intensity _ν_ and unit jump size. An order can be cancelled by the client
only if it is present, so jumps of _C_ affect _L_ only when liquidity is available at that time.


  - ( _At_ ) _t≥_ 0 represents the arrival of new orders and may also be interpreted as the non-instantaneous
replenishment of a previously filled limit order. It is modelled as a Poisson process with intensity _µ_ and unit jump size. While, in practice, a new order could arrive while another is still
active, such events are sufficiently rare that we restrict arrivals to occur only when no order
is currently present. This assumption is consistent with the behaviour of a TWAP placement
algorithm.


  - ( _Mt_ ) _t≥_ 0 represents the cumulative market orders submitted by the dealer. We assume that
these orders occur at jump times, which are F-stopping times _{τn}n≥_ 1 controlled by the market


3


maker, and that each transaction is of unit size. Market orders can only occur at times when
_Lt >_ 0, and are zero otherwise. Hence, they are chosen from the class


T = _{τ_ : _τ_ is an F-stopping time and _Lτ_ _−_ _≥_ 1 _} ._ (2.4)


We then define _Mt_ = [�] _n≥_ 1 [1] _[{][τ]_ _n_ _[≤][t][}][.]_


  - ( _Rt_ ) _t≥_ 0 represents the replenishment process of an order immediately after the dealer consumes
the last unit of liquidity. We assume that _Rt_ = [�] _n_ _[∞]_ =1 _[χ][n]_ [1] _[{][τ]_ _n_ _[≤][t][}]_ [1] _[{][L]_ _τn_ [=0] _[}][,]_ [ where][ (] _[χ][n]_ [)] _[n][≥]_ [1][ is]
a sequence of i.i.d. Bernoulli random variables with parameter _p ∈_ [0 _,_ 1]. Replenishment
typically occurs when an internal exchange order is part of a larger iceberg order.


The pricing offset of the internal exchange order relative to the mid-price is denoted by the parameter
_ρ_, which can be positive or negative. The price at which the market maker can trade is given by,



_Pt_ =




_St_ + _ρ_ if _Lt >_ 0

_∞_ if _Lt ≤_ 0 _._



The dealer receives an infinitely unfavorable price when trading is impossible. In practice, internal
exchange orders may yield a small fee for the client. From the modeling perspective this can be
incorporated by letting _ρ_ = ˜ _ρ_ _−_ _ξ_, where ˜ _ρ_ is the price offset relative to the mid chosen by the client,
and _ξ >_ 0 is a constant representing the fee per unit. Throughout the paper, we work directly with
_ρ_ .


The dealer’s position and cash processes are given by,


_Qt_ =              - _z_              - _Nt_ _[b,z]_ _−_ _Nt_ _[a,z]_              - + _Mt,_

_z∈Z_



�� _t_


_z_

0

_z∈Z_




 _Xt_ =



_t_  - _t_

_Ss_ _[a,z][dN]_ _s_ _[a,z]_ _−_
0 0



_Ss_ _[b,z][dN]_ _s_ _[b,z]_
0




- - _t_

_−_ _PsdMs,_

0



respectively. The value function of the maker maker is,




           
_v_ ( _t, s, q, x, l_ ) = sup E
_δ_ _[b]_ _,δ_ _[a]_ _,_ ( _τn_ ) _n≥_ 1




          - _T_
_XT_ + _QT ST −_ _αQ_ [2] _T_ _[−]_ _[ϕ]_



_T_ - _T_

_Q_ [2] _s_ _[ds][ −]_ _[ψ]_
_t_ _t_



_T_

( _Ls_ ) [+] _ds_ _Ft_
_t_ ����







_,_ (2.5)



were the supremum is taken over _δ_ _[b]_ _, δ_ _[a]_ _∈D_ and _τn ∈_ T (see (2.1) and (2.4)). The constants _α, ϕ, ψ_
are nonnegative and ( _·_ ) [+] is the positive part function. The first two terms on the right-hand side of
(2.5) represent the terminal value of the market maker’s portfolio; that is, the cash position plus the
risky asset position valued at mid. The third and fourth terms implement penalties on the terminal
and running positions respectively. The fifth term implements a running penalty on unfilled internal
exchange orders.


Using the mathematical argument in [14, Chapter 11,Theorem 11.1], the dynamic programming
principle yields that the value function _v_ satisfies the following Hamilton-Jacobi-Bellman quasivariational inequality (HJBQVI),


4


[2] _∂_ [2] _v_

[(] _[t, s, q, x, l]_ [)] _[ −]_ _[ϕq]_ [2] _[ −]_ _[ψ][ ·]_ [ (] _[l]_ [)][+]
2 _∂s_ [2]



0 = max




_∂v_



_∂v_ _[σ]_ [2]

_∂t_ [(] _[t, s, q, x, l]_ [) +] 2




 +


_z∈Z,i∈{b,a}_




sup
_δ_ _[i,z]_





                           - [��]
_λ_ _[i,z]_ _e_ _[−][κ][z][δ][i,z]_ [ �] _v_ ( _t, s, q ± z, x −_ _zs_ + _zδ_ _[i,z]_ _, l_ ) _−_ _v_ ( _t, s, q, x, l_ )



+ _ν_ - _v_ ( _t, s, q, x, l −_ _ℓ_ ) _−_ _v_ ( _t, s, q, x, l_ )� 1 _{l>_ 0 _}_ + _µ_ - _v_ ( _t, s, q, x, l_ + _ℓ_ ) _−_ _v_ ( _t, s, q, x, l_ )� 1 _{l≤_ 0 _},_

1 _{l>_ 1 _}_ ( _v_ ( _t, s, q_ + 1 _, x −_ _s −_ _ρ, l −_ 1))

+ 1 _{l≤_ 1 _}_ - _p v_ - _t, s, q_ + 1 _, x −_ _s −_ ( _ρ_ 1 _{l>_ 0 _}_ + _∞_ 1 _{l≤_ 0 _}_ ) _, l −_ 1 + _ℓ_ 

                     


(2.6)



+ (1 _−_ _p_ ) _v_     - _t, s, q_ + 1 _, x −_ _s −_ ( _ρ_ 1 _{l>_ 0 _}_ + _∞_ 1 _{l≤_ 0 _}_ ) _, l −_ 1�� _−_ _v_ ( _t, s, q, x, l_ )


with terminal condition
_v_ ( _T, s, q, x, l_ ) = _x_ + _qs −_ _αq_ [2] _._



_,_



The terms on the first argument of the maximum in (2.5) arise from Itô’s formula for jump diffusions.
The second part of the maximum relates to times where an internal exchange order is traded. In
particular, when there is no internal exchange standing liquidity, this term evaluates to _−∞_ and
thus the first part of the maximum is larger. The _±_ sign in (2.6) relates to terms indexed by _b_ ( _a_ )
having a plus (minus) sign, respectively. By using the ansatz


_v_ ( _t, s, q, x, l_ ) = _x_ + _qs_ + _h_ ( _t, q, l_ ) _,_


we can reduce the dimension of (2.6). Solving the Hamiltonians in feedback form then yields




   _∂h_

0 = max

_∂t_ [(] _[t, q, l]_ [)] _[ −]_ _[ϕq]_ [2] _[ −]_ _[ψ][ ·]_ [ (] _[l]_ [)][+]



_z_ ��

_z_ [(] _[h]_ [(] _[t, q][ ±][ z, l]_ [)] _[ −]_ _[h]_ [(] _[t, q, l]_ [))]




 +


_z∈Z,i∈{b,a}_




- _zλi,ze−_ 1



_i,ze−_ 1 - _κz_

exp
_κ_ _[z]_ _z_



+ _ν_      - _h_ ( _t, q, l −_ _ℓ_ ) _−_ _h_ ( _t, q, l_ )� 1 _{l>_ 0 _}_ + _µ_      - _h_ ( _t, q, l_ + _ℓ_ ) _−_ _h_ ( _t, q, l_ )� 1 _{l≤_ 0 _},_

        - _p h_ ( _t, q_ + 1 _, l −_ 1 + _ℓ_ ) + (1 _−_ _p_ ) _h_ ( _t, q_ + 1 _, l −_ 1)� 1 _{l≤_ 1 _}_


                     + _h_ ( _t, q_ + 1 _, l −_ 1) 1 _{l>_ 1 _} −_ _h_ ( _t, q, l_ ) _−_      - _ρ_ 1 _{l>_ 0 _}_ + _∞_ 1 _{l≤_ 0 _}_      

with terminal condition _h_ ( _T, q, l_ ) = _−αq_ [2] . The optimal depths are given by,



(2.7)



_δ_ _[i,z]_ ( _t, q, l_ ) = [1]




[1] [1]

[+]
_κ_ _[z]_ _z_



for _i ∈{b, a},_ (2.8)
_z_ [(] _[h]_ [(] _[t, q, l]_ [)] _[ −]_ _[h]_ [(] _[t, q][ ±][ z, l]_ [))] _[,]_



and the optimal execution times ( _τn_ ) _n≥_ 0 are the times such that the maximum in (2.7) evaluates
as the second term. We refer to the subspace where this holds as the execution region.

### **3 Optimal strategy**


In this section, we investigate the behaviour of the optimal strategy obtained by numerically solving
(2.7) using a backward Euler scheme. An anonymised subsample of HSBC GBPUSD trade data was


5


used to calibrate the intensities _λ_ _[a,z]_ and _λ_ _[b,z]_, as well as the sensitivity of fill probabilities to quotes,
_κ_ _[z]_, for _z ∈Z_ = _{_ 1 _,_ 5 _,_ 10 _}_ . Specifically, we set _κ_ [1] = 1 _._ 5, _κ_ [5] = 1 _._ 0, _κ_ [10] = 0 _._ 5, _λ_ _[b,]_ [1] = _λ_ _[a,]_ [1] = 0 _._ 2,
_λ_ _[b,]_ [5] = _λ_ _[a,]_ [5] = 0 _._ 005, and _λ_ _[b,]_ [10] = _λ_ _[a,]_ [10] = 0 _._ 001. Each _κ_ is measured in bps [-1], and each _λ_ _[a,z]_, _λ_ _[b,z]_ in
seconds [-1] . The inventory penalties are given by _ϕ_ = _α_ = 0 _._ 001, and the penalty for unfilled internal
exchange orders is _ψ_ = 0 _._ 01. The time horizon is _T_ = 300 seconds, which represents a reasonable
high-frequency risk management period. We consider a range of client prices ˜ _ρ_ and three parameter
configurations for (2.3) corresponding to different client algos.


  - **Iceberg.** The client executes without interruption, but the total size of the order is never
visible. As such, when the order is filled by the market maker, it is immediately replenished.
At some point, the client finishes executing, and the order is no longer renewed. To represent
this, the replenishment probability is set to _p_ = 0 _._ 9, meaning there is a 10% chance that, after
liquidity is taken, it is not renewed. Additionally, there is a small probability that the order is
spontaneously cancelled by the client, given by _ν_ = 0 _._ 001 s [-1] . For simplicity, we do not allow
new orders after the iceberg order finishes executing, so _µ_ = 0. We let the order size be one
million notional, and therefore set _ℓ_ = 1.


  - **TWAP.** The client executes at a constant pace, but orders arrive with pauses of random
lengths from the perspective of the market maker. There is no instantaneous replenishment,
so we set _p_ = 0. The arrival process _A_ represents the renewal of the order some time after
it has been consumed, and we set its intensity to _µ_ = 0 _._ 05 s [-1] . As in the case of the iceberg
strategy, we let _ν_ = 0 _._ 001 s [-1] and _ℓ_ = 1.


  - **Full Amount.** The client places their entire order at once and never updates it, except for
the possibility of cancellation. Therefore, there is no instantaneous replenishment ( _p_ = 0) and
no arrivals ( _µ_ = 0). However, the initial order size is larger than one, and we set _ℓ_ = 10. As
before, the cancellation rate is _ν_ = 0 _._ 001 s [-1] .


**3.1** **Optimal quotes**


In Figure 1 we plot the optimal bid-depths _δ_ _[b,z]_ and ask-depths _δ_ _[a,z]_ at _t_ = 0 for _z ∈Z_ for different
inventory positions of the market maker, in the case where client orders are placed at mid price
( _ρ_ ˜ = 0). We chose the snapshot at _t_ = 0 as the strategy is approximately stationary away form
the terminal time _T_ . We observe in Figure 1 (left panel) that, in the iceberg scenario, the askside quotes are lower near the execution region (i.e., when the market maker has a short position
greater than one unit, _q < −_ 1) and the limit order is present (dashed lines), compared with the
classical Avellaneda-Stoikov benchmark (solid lines). This occurs because the market maker is more
willing to accumulate inventory, given the possibility of closing the position through the limit order
if necessary. The effect becomes more pronounced with larger ask sizes and weaker with larger bid
sizes, forming a substantial passive impact on both bid and ask prices. In contrast, this effect is
marginal in the presence of a TWAP order due to the time intervals between successive renewals of
the client’s orders (see right panel).


In Figure 2, we show the full (one-time) client order scenario for an outstanding order of 10 units
(left) and one unit remaining (right). Prices adjust much more relative to the no-internal-order case
when the order is full at _L_ = 10, since greater available liquidity allows larger positions to be closed
internally. Note that the trading region here is now _q <_ 5 due to the fact that the order will not
repeat itself and the market maker can mitigate the internal execution urgency term (the fifth term
on the right-hand side of (2.5)) by taking the liquidity. This happens both when _L_ = 10 and _L_ = 1
due to the linearity of the penalty for positive _L_ .


6


Figure 1: Ask and bid depths, _δ_ _[b,z]_ (0 _, q,_ 1) and _δ_ _[a,z]_ (0 _, q,_ 1), when an internal exchange order is
present (dashed lines), and when it is not (solid lines), for _z ∈Z_, in the presence of an iceberg (left)
and TWAP (right) client algorithm in the internal exchange. Bid (ask) depths are shown in blue
(red), with lighter shades corresponding to larger values of _z_ . Dashed lines corresponding to cases
where the internal exchange order is available are shown only for values of _q_ outside the execution
region, where the internal exchange order is taken. The area to the left of the green line indicates
the region where the market maker trades with the internal exchange.


Figure 2: Ask and bid depths when then internal exchange order is present as in Figure 1, now for
when the internal exchange order is of full amount type with 10 (left) and 1 (right) units remaining.


We therefore conclude that the type and magnitude of order determines the extent of price
adjustment due to internal exchange orders, which can be perceived externally as passive price
impact. The pricing adjustments are more pronounced when the expected remaining liquidity on
the internal exchange is high. Since clients rarely disclose their trading strategies, a data-driven
approach may be needed to infer internal order properties and decide on external price adjustments,
initially assuming a standalone order and updating quotes after the first fill.


**3.2** **When to trade with the internal exchange**


In Figure 1, we observed that, for the chosen parameters, it was optimal to trade with the internal
exchange whenever the position was negative in the TWAP case, and when the position was sufficiently negative in the iceberg case. In contrast, in Figure 2, it was optimal to trade when the
position was already positive. This indicates that the optimal execution boundary depends on the
model parameters. Figure 3 illustrates how this boundary changes with the client’s price _ρ_ in the


7


iceberg and TWAP cases. Recall that, in this section, there is no fee ( _ξ_ = 0), so _ρ_ = ˜ _ρ_ .


We observe that when the client posts aggressively, with a price below the mid ( _ρ <_ ˜ 0), the
market maker may be willing to trade with the internal exchange order even if doing so worsens
their position (a behaviour known as risk increasing). This pattern reflects a trade-off between
optimising P&L, managing inventory costs, and accommodating the urgency of executing internal
orders (as described below (2.5)). Owing to the quadratic inventory risk term, holding a small
position is penalised less per unit than holding a large one; hence, the market maker may prefer to
hold a small negative position rather than always remain non-negative when ˜ _ρ_ is large.


One of the main conclusions from Figure 3 is that clients can expect the time required to fill
their orders to be more sensitive to their price offset from the mid when using a TWAP strategy
than when using an iceberg order. We demonstrate this result quantitatively in Table 2 in Section
4. The main reason for the difference in trading regions between the iceberg and TWAP scenarios
for aggressive client orders ( _ρ <_ ˜ 0) is that, at these prices, iceberg orders effectively represent a
batch of existing orders that the market maker can use to make an immediate profit and to close a
short position when needed. Therefore, the market maker tends to postpone consuming them until
holding a sufficiently negative inventory. In contrast, TWAP orders arrive at an exponential rate
and are only placed when there are no outstanding client orders. Hence, it is more profitable to
consume them immediately regardless of inventory, as otherwise new orders will not arrive.


Figure 3: The largest position at which it is optimal to fill the internal exchange order vs. as the
client’s price offset ˜ _ρ_ . The blue line illustrates the iceberg order scenario, while the orange line
shows TWAP case.

### **4 Naïve benchmark and performance comparison**


In this section, we compare the performance and behaviour of the optimal strategy obtained by
solving the HJBQVI (2.7) and using the optimal depths (2.8), with common heuristic benchmark
strategies. We use the same parameters as in Section 3. Moreover, due to the 24-hour nature of the
FX market, we evaluate the optimal strategy at time _t_ = 0 to neglect terminal inventory constraints
in our comparison. This assumption is justified, as the strategy becomes time-independent when
sufficiently far from the end of the time horizon. The following algorithm describes the naïve
benchmark strategy.


In Algorithm 1 when the market maker’s position is negative and an internal exchange order


8


**Algorithm 1** Naïve benchmark strategy

**Initiate** Set _t_ = 0 and _L_ 0 = _ℓ_ [¯] _≥_ 0 in (2.3).
**while** _t ≤_ _T_ **do**

**if** the available liquidity _Lt ≤_ 0 **then**

Use Avellaneda–Stoikov quotes (i.e. (2.2) at time zero with _L ≡_ 0),
**else**

**if** _Qt <_ 0 **then**

Purchase the internal exchange outstanding order and update _Lt_ +∆ _←_ _Lt −_ 1
**else**

Use Avellaneda-Stoikov bid quotes and **adjusted** ask quotes in (4.1).
**Set** _t ←_ _t_ + ∆.


is present, it is filled [1] . If no such order exists, prices are set using the Avellaneda-Stoikov model,
that is the case when there is no internal exchange ( _L ≡_ 0). Prices on the ask side are adjusted
according to a hubristic rule which is described below.

We let _δ_ _[a,z][k][,AS]_ (0 _, q_ ) denote the optimal half-spreads at _t_ = 0 in the Avellaneda–Stoikov model,
i.e., those corresponding to our model with _L ≡_ 0 and allowing for multiple order sizes (see [7]).
In the presence of a client’s sell order of size _l_ at a price ˜ _ρ_ above the mid-price, the market maker
inserts an order on the ask side of their pricing ladder with size _l_ at a price ˜ _ρ_ + _ι_ above mid, where
_ι >_ 0 is the margin introduced by the dealer. We then compute a new volume-weighted average
price (VWAP) to obtain the naïve strategy’s half-spreads.

Let the order sizes _z_ 1 _< z_ 2 _, ..._ and let _zi_ = min _{z ∈Z_ : ˜ _ρ_ + _ι < δ_ _[a,z,AS]_ (0 _, q_ ) _}_ . The naïve strategy’s
half-spreads when there is an order on the internal exchange are then given by _δ_ [˜] _[a,z][j]_ _[,BM]_ (0 _, q, l_ ) =
_δ_ _[a,z][j]_ _[,AS]_ (0 _, q_ ) if _δ_ _[a,z][j]_ _[,AS]_ (0 _, q_ ) _<_ ˜ _ρ_ + _ι_, which is when _j < i_, and for _j ≥_ _i_,



_δ_ ˜ _[a,z]_ _j_ _[,BM]_ (0 _, q, l_ ) = [1]

_zj_





_l_ (˜ _ρ_ + _ι_ ) + _zi−_ 1 _δ_ _[a,z][i][−]_ [1] _[,AS]_ ( _t, q_ )+



��



+ _l_



_j_



_r_ = _i_ +1



�� _zr−_ 1 _δa,zr−_ 1 _,AS_ ( _t, q_ ) _−_ _zr−_ 2 _δa,zr−_ 2 _,AS_ ( _t, q_ )

_zr−_ 1 _−_ _zr−_ 2



�� [�]



+



_j_



_r_ = _i_




- - _zrδa,zr,AS_ ( _t, q_ ) _−_ _zr−_ 1 _δa,zr−_ 1 _,AS_ ( _t, q_ )
( _zr −_ _zr−_ 1 _−_ _l_ )

_zr −_ _zr−_ 1



To summarise, the prices quoted by the market maker are,



_δ_ _[a,z][j]_ _[,BM]_ (0 _, q, l_ ) =




- _δ_ ˜ _a,zj_ _,BM_ (0 _, q, l_ ) if _l >_ 0 _,_

(4.1)
_δ_ _[a,z][j]_ _[,AS]_ (0 _, q_ ) if _l ≤_ 0 _._



The prices on the bid-side remain unchanged in the presence of the client’s order, that is _δ_ _[a,z][j]_ _[,BM]_ (0 _, q, l_ ) =
_δ_ _[a,z][j]_ _[,AS]_ (0 _, q_ ) (see Algorithm 1). [2]


In Table 1, we compare the mean and standard deviation of the simulated P&L, defined as
_P_ & _L_ = _XT_ + _QT ST_ (see (2.5)), across different types of client orders and client pricing levels:


1In reality, this may depend on the client’s posted price ˜ _ρ_ ; however, this is reasonable for aggressive and mildly
passive pricing.
2Alternatively, one can consider removing equivalent size from the bid ladder.


9


aggressive ( _ρ_ = _−_ 0 _._ 2), mid ( _ρ_ = 0), and passive ( _ρ_ = 0 _._ 2). In all cases, the market maker’s initial
position is zero, fees are set to _ξ_ = 0, the time step is ∆= 0 _._ 3 s, the time horizon is _T_ = 300 seconds,
and the number of simulated trajectories is 5 _,_ 000. We compare the performance of the optimal
strategy with that of the naïve benchmark strategy using a margin of _ι_ = 0 _._ 1. We observe that
the optimal strategy consistently outperforms the naïve benchmark, and that the market maker’s
profits are slightly more sensitive to the client’s pricing offset ˜ _ρ_ in the TWAP and full-amount cases
than in the iceberg case.


In Table 2, we observe that the expected first fill times of internal client orders under the naïve
benchmark strategy are generally shorter than those under the optimal strategy. This results from
the naïve strategy’s more aggressive pricing adjustments and its execution rule of always taking
when the inventory is negative. In particular, the market maker readily goes short and therefore
fills internal exchange orders more frequently. We also observe that the change in the mean time to
first fill under the optimal strategy is more sensitive to the client’s pricing offset ˜ _ρ_ when a TWAP
order is used than when an iceberg order is used. Finally, when a full-amount order is used, the
time to first fill is always zero under the optimal strategy, as the initial position of zero lies within
the region where the market maker trades with the internal exchange (see Figure 2).


**P&L (K$)**
**Aggressive:** _ρ_ = _−_ 0 _._ 2 **At mid:** _ρ_ = 0 **Passive:** _ρ_ = 0 _._ 2


Optimal 3.788 (1.62) 3.677 (1.6) 3.603 (1.6)
**Iceberg**
Naïve 3.384 (1.69) 3.36 (1.69) 3.347 (1.69)

Optimal 3.84 (1.65) 3.708 (1.61) 3.673 (1.59)
**TWAP**
Naïve 3.381 (1.5) 3.399 (1.53) 3.405 (1.56)

Optimal 3.744 (2.0) 3.547 (2.0) 3.354 (2.0)
**FA**
Naïve 3.452 (1.6) 3.433 (1.58) 3.404 (1.57)


Table 1: Mean (standard deviation) of P&L in thousand $, in the presence of different client algos
with passive, at mid, and aggressive placement for iceberg, TWAP and full amount (FA) scenarios.


**Time to First Fill (seconds)**
**Aggressive:** _ρ_ = _−_ 0 _._ 2 **At mid:** _ρ_ = 0 **Passive:** _ρ_ = 0 _._ 2


Optimal 21.133 (31.57) 47.965 (53.67) 56.681 (63.16)
**Iceberg**
Naïve 5.147 (6.5) 7.59 (10.36) 12.145 (18.64)

Optimal Always zero 24.518 (34.69) 68.221 (68.3)
**TWAP**
Naïve 5.571 (7.7) 7.797 (10.24) 12.507 (18.12)

Optimal Always zero Always zero Always zero
**FA**
Naïve 5.309 (6.7) 7.402 (9.82) 12.063 (17.34)


Table 2: Mean (standard deviation) of time to fill for the first internal exchange order in seconds,
in the presence of different client algos with passive, at mid, and aggressive placement for iceberg,
TWAP and full amount (FA) scenarios.


Although execution times under the optimal strategy are slower than those of the naïve strategy,
the latter substantially reduces the market maker’s P&L. To sustain internal flow without harming
performance, an additional compensation mechanism is required. Figure 4 shows the impact of fees
_ξ_ and margins _ι_ on P&L (left) and fill rate (right). Margins are the least effective option: while they
improve the naïve strategy’s P&L similarly to fees, they also reduce the volume of internal exchange


10


executions. Fully compensating the naïve strategy would require a large fee, which could in practice
discourage internal exchange participation, an effect not captured by the model. In contrast, the
optimal strategy benefits from fees, improving both P&L and turnover.


Figure 4: P&L (left) and internal exchange volume per second _[M][T]_ (right) for optimal market maker’s

_T_
strategy (blue) and naïve benchmark strategy (red) in the presence of an iceberg as functions of fee
(solid lines) or margin (dashed lines). Reference P&L using Avellaneda-Stoikov pricing without an
internal exchange is shown for comparison (orange).

### **5 Conclusion**


We have introduced a model in which a market maker continuously streams prices to clients while
also having the option to take liquidity from dynamic passive orders on an internal exchange. We
solve for the optimal strategy using an HJBQVI and demonstrate its superior performance compared
to a heuristic benchmark strategy that directly incorporates internal exchange orders into the OTC
pricing ladder.


The optimal strategy defines an inventory-dependent execution threshold beyond which the
market maker is willing to immediately take the internal exchange order. Otherwise, the market
maker skews prices to facilitate the opposing flow. The degree of skew and the positioning of the
execution threshold depend on the market maker’s risk aversion, client order depth and placement
strategy, as well as on flow facilitation initiatives.


Notably, the skew mechanism revealed in our analysis highlights a potential origin of passive
market impact: clients place passive orders on the internal exchange, prompting the market maker
to skew prices for their OTC clients. As described in [10], these clients may then extract alpha from
the resulting skew, leading the market to move.

### **Acknowledgments**


The views expressed are those of the authors and do not necessarily reflect the views and practices
at HSBC. The authors are grateful to Richard Anthony (HSBC) for helpful discussions and support
throughout the project.


11


### **References**


[1] Á. Cartea, S. Jaimungal, and J. Ricci. Buy Low Sell High: A High Frequency Trading
Perspective. _SIAM J. Financ. Math._, 5(1):415–444, 2014


[2] Á. Cartea, and S. Jaimungal. Optimal Execution with Limit and Market Orders. _Quant_
_Finance._, 15(8):1279–1291, 2015.


[3] Y. Morimoto. Optimal Execution Strategies Incorporating Internal Liquidity Through Market
Making. Preprint, available at SSRN:5074405, 2024.


[4] Á. Cartea, and L. Sánchez-Betancourt. Brokers and informed traders: dealing with toxic flow
and extracting trading signals. _SIAM J. Financ. Math._, 16(2):243–270 2025


[5] A. Barzykin, P. Bergault, and O. Guéant. Algorithmic market making in dealer markets with
hedging and market impact. _Mathematical Finance_, 33(1):41–79, 2024/06/11 2023.


[6] M. Butz and R. Oomen. Internalisation by electronic fx spot dealers. _Quant Finance._, 19(1):
35–56, 01 2019.


[7] P. Bergault, and O. Guéant. Size matters for OTC market makers: General results and
dimensionality reduction techniques _Math Financ._, 31 (1): 279-322., 2021.


[8] O. Guéant, C-A. Lehalle, and J. Fernandez-Tapia. Dealing with the inventory risk: a solution
to the market making problem _Math. Financ. Econ._, 7 (4): 477–507., 2013.


[9] Y.O. Chahdi, M. Rosenbaum, G. Szymanski. A theory of passive market impact Preprint,
available at arXiv:2412.07461, 2024.


[10] A. Barzykin, P. Bergault, O. Guéant, and M. Lemmel. Optimal Quoting under Adverse
Selection and Price Reading Preprint, available at arXiv:2508.20225, 2025.


[11] R. Boyce, M. Herdegen, and L. Sánchez-Betancourt. Market making with exogenous competition. _SIAM J. Financ. Math._, 16(2):692–706, 2025.


[12] M. Avellaneda and S. Stoikov. High-frequency trading in a limit order book _Quantitative_
_Finance_, 8(3):217–224, 2008.


[13] Á. Cartea, S. Jamingual, and J. Penalva. Algorithmic and High Frequency Trading _Cambridge_
_University Press, Cambridge, United Kingdom, 2015_ ISBN 9781107091146


[14] B. Øksendal, and A. Sulem. Applied Stochastic Control of Jump Diffusions _Springer, Berlin,_
_Germany, 2019_ ISBN 3540140239


[FXPA guidance] FXPA Guidance: Definitions & Best Practices for FX Internalisation in Algo
Execution Published by the Foreign Exchange Professionals Association (FXPA), July 2025.


12


